
<!DOCTYPE html>
<html lang="pt-br" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <base href="http://tableless.com.br/">
  <title>Tableless</title>
  <link rel="canonical" href="http://tableless.com.br/iniciando-com-symfony-2-parte-03/">
  <link href="" rel="alternate" type="application/rss+xml" title="Tableless" />
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css">
  
</head>
<body>


  <header id="tb-header">
    <a href="http://tableless.com.br/" class="tb-logo"><img src="images/logo.svg"></a>

    

    <nav id="tb-menu">
      <ul>

        
          
              
            <li>
              <a href="/categories/html">
                  
                  HTML
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/css/">
                  
                  CSS
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/javascript/">
                  
                  JavaScript
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/back-end/">
                  
                  Back-end
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/wordpress/">
                  
                  WordPress
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/acessibilidade/">
                  
                  Acessibilidade
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/design/">
                  
                  Design
              </a>
          
            </li>
          
              
            <li>
              <a href="/categories/t%C3%A9cnicas-e-pr%C3%A1ticas/">
                  
                  Na prática
              </a>
          
            </li>
          

      </ul>
    </nav>

  </header>

  <header class="tb-post-header">
    <h1 class="tb-hero-title"><a href="/iniciando-com-symfony-2-parte-03/">Iniciando com Symfony 2 – Parte 03</a></h1>
  <p class="tb-hero-p">
    
    Nesse tutorial vamos criar uma entidade e fazer o CRUD para nossa aplicação, e para agilizar nosso processo, continuaremos a usar o componente Console do Symfony 2, porém, em conjundo com Doctrine ORM.
    
  </p>
      <span class="tb-author">por <a href="/author/candido-souza">Candido Souza</a></span>


  </header>


<section class="tb-post">

  <section class="tb-post-content">
    <article class="tb-post-article">
      

<p><a href="http://tableless.com.br/iniciando-com-symfony-2-parte-02/" title="Iniciando com Symfony - parte 2" target="_blank">Dando continuidade ao tutorial anterior</a>, vamos continuar usando o componente console do Symfony, agora criaremos uma entidade, para acessar o banco de dados, usando o Doctrine ORM.</p>

<h2 id="banco-de-dados-com-doctrine-orm">Banco de dados com Doctrine ORM</h2>

<p>Quando falamos de banco de dados em projetos com Symfony, estamos falando de Doctrine ORM (Object Relational Mapper), onde criamos uma camada de persistência entre a aplicação e um banco de dados, que mapeia nossas tabelas com entidades, para que possamos acessar o banco.</p>

<p>Não vou me aprofundar sobre Doctrine, porém, o que você precisa saber é que o Doctrine é um projeto espetacular e grandioso, muito usado pela comunidade, para projetos robustos.</p>

<h2 id="iniciando-com-doctrine-orm">Iniciando com Doctrine ORM</h2>

<p>O Doctrine já vem instalado e configurado no Symfony. Lembrando que você pode instalá-lo <a href="https://packagist.org/packages/doctrine/orm" title="Doctrine ORM" target="_blank">separadamente via Composer</a>. <a href="http://tableless.com.br/iniciando-com-symfony-2/" title="Instalação do Symfony" target="_blank">No primeiro post que escrevi</a> sobre a instalação do Symfony, nós configuramos as opções de banco de dados, o host, usuário e senha. Vale lembrar que são de configuração pessoais, configuradas em sua máquina.</p>

<p>No meu caso, configurei de acordo com minhas configurações do MySQL. Também demos um nome para o banco de dados que vamos utilizar agora e que foi configurado com o nome “symfony”. Porém este não está criado, vamos criá-lo neste momento usando o componente console do Symfony em conjunto com o Doctrine.</p>

<p>Vamos digitar no terminal para criar nosso banco:</p>

<pre class="lang-bash">$ php app/console doctrine:database:create
</pre>

<p>E obteremos a resposta: Banco de dados criado para a conexão, com o nome &#8216;symfony&#8217;.</p>

<pre class="lang-bash">$ Created database for connection named 'symfony'
</pre>

<h2 id="gerando-entidades">Gerando Entidades</h2>

<p>Agora que nosso banco foi gerado, vamos iniciar criando uma entidade. No Doctrine são objetos leves que contêm propriedades persistentes, que são salvos e recuperados do banco de dados por recursos de mapeamento de dados.</p>

<p>Para gerarmos uma entidade vamos digitar no terminal:</p>

<pre class="lang-bash">$ php app/console generate:doctrine:entity
</pre>

<p>Neste momento o console nos dá a dica do que devemos fazer:</p>

<p>&#8220;Em primeiro lugar, você precisa dar o nome para a entidade que pretende gerar.</p>

<p>Você deve usar a notação de atalho como AcmeBlogBundle:Post.&#8221;</p>

<p>Em nosso caso vamos digitar &#8220;TablelessModelBundle:Post&#8221;, para criar a entidade Post no bundle TablelessModelBundle.</p>

<pre class="lang-bash">$ TablelessModelBundle:Post
</pre>

<p>Feito isso, o console nos pergunda: Qual o formato que vamos usar para obter as informações de mapeamento? Por padrão ele nos indica annotation, vamos deixar como está e damos enter.</p>

<pre class="lang-bash">$ Configuration format (yml, xml, php, or annotation) [annotation]:
</pre>

<p>As annotations são usadas pelo Doctrine para mapear as entidades, e obter informações por meio delas.</p>

<p>Após darmos o enter, o console nos indica a inserir novos campos, (Obs: automaticamente, já foi gerado o &#8220;id&#8221; como primary key), e nos pergunta qual o nome do novo campo que vamos criar:</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields):
</pre>

<p>Você pode interromper, apenas dando um enter, em nosso caso vamos continuar, digitando o nosso primeiro campo que será &#8220;title&#8221;, o titulo de nosso post, damos enter.</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields):title
</pre>

<p>Nos pergunta qual o tipo, que vamos usar nesse campo, e ele nos indica “string”, vamos deixar como está, apenas damos um enter.</p>

<pre class="lang-bash">$ Field type [string]:
</pre>

<p>A próxima pergunta é: Qual o comprimento desse campo? E por padrão nos indica &#8220;255&#8221;, você pode deixar assim, em nosso caso vamos digitar &#8220;150&#8221;, como é um título, para esse projeto não vejo necessidade de mais, damos enter.</p>

<pre class="lang-bash">$ Field length [255]:150
</pre>

<p>Criamos nosso primeiro campo na entidade, como é um post, vamos precisar além do titulo, um conteúdo, quando o post foi criado, e quando foi atualizado, então vamos criar nosso próximo campo, digitamos &#8220;content&#8221;.</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields): content
</pre>

<p>O tipo deste campo será um texto, digitamos &#8220;text&#8221;.</p>

<pre class="lang-bash">$ Field type [string]:text
</pre>

<p>Automaticamente, o console não nos pede o tamanho, pois é um campo do tipo text. Vamos para o nosso próximo campo, por convenção digitamos createdAt.</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields): createdAt
</pre>

<p>O tipo será uma data, então digitamos &#8220;datetime&#8221;.</p>

<pre class="lang-bash">$ Field type [string]: datetime
</pre>

<p>Vamos para o próximo campo. Nosso post, pode ser atualizado, e para sabermos qual foi a data de atualização vamos criar um campo para isso, digitamos &#8220;updatedAt&#8221;, também com o tipo &#8220;datetime&#8221;.</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields): updatedAt
</pre>

<p>Tipo</p>

<pre class="lang-bash">$ Field type [string]: datetime
</pre>

<p>Como vamos criar um simples blog, e não vamos fazer nada complexo, deixaremos somente estes campos, você pode criar mais campos como texto de introdução, etc, nesse momento vamos deixar assim, e quando o console nos perguntar novamente sobre um novo campo, não vamos digitar nada, apena vamos dar um enter, para entrarmos no processo de finalização.</p>

<pre class="lang-bash">$ New field name (press  to stop adding fields):
</pre>

<p>Após o enter, ele nos pergunta se queremos criar uma classe de repositório vazia para a nossa entidade Post, e por padrão, nos indica [não], no momento não vamos usar repositórios, abordaremos isso mais pra frente, novamente damos enter.</p>

<pre class="lang-bash">$ Do you want to generate an empty repository class [no]?
</pre>

<p>Nesse momento o console nos pergunta, se confirmamos a geração da nossa entidade, por padrão ele nos indica [Sim], como queremos, damos enter.</p>

<pre class="lang-bash">$ Do you confirm generation [yes]? 
</pre>

<p>Pronto, nossa primeira entidade está criada!</p>

<p>Ao entrarmos em nosso projeto, notaremos que uma pasta &#8220;Entity&#8221; foi criada, e nela teremos nossa entidade &#8220;Post&#8221;.</p>

<p><a href="http://tableless.com.br/wp-content/uploads/2015/02/011.png"><img src="http://tableless.com.br/wp-content/uploads/2015/02/011.png" alt="Criando entidades no symfony" width="750" height="403" class="alignnone size-full wp-image-46965" srcset="uploads/2015/02/011.png 750w, uploads/2015/02/011-259x139.png 259w, uploads/2015/02/011-400x215.png 400w" sizes="(max-width: 750px) 100vw, 750px" /></a></p>

<p>Nossa entidade Post criada:</p>

<pre class="lang-php">&lt;?php

namespace Tableless\ModelBundle\Entity;

use Doctrine\ORM\Mapping as ORM;

/**
 * Post
 *
 * @ORM\Table()
 * @ORM\Entity
 */
class Post
{
    /**
     * @var integer
     *
     * @ORM\Column(name="id", type="integer")
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="AUTO")
     */
    private $id;

    /**
     * @var string
     *
     * @ORM\Column(name="title", type="string", length=255)
     */
    private $title;

    /**
     * @var string
     *
     * @ORM\Column(name="content", type="text")
     */
    private $content;

    /**
     * @var \DateTime
     *
     * @ORM\Column(name="createdAt", type="datetime")
     */
    private $createdAt;

    /**
     * @var \DateTime
     *
     * @ORM\Column(name="updatedAt", type="datetime")
     */
    private $updatedAt;


    /**
     * Get id
     *
     * @return integer 
     */
    public function getId()
    {
        return $this-&gt;id;
    }

    /**
     * Set title
     *
     * @param string $title
     * @return Post
     */
    public function setTitle($title)
    {
        $this-&gt;title = $title;

        return $this;
    }

    /**
     * Get title
     *
     * @return string 
     */
    public function getTitle()
    {
        return $this-&gt;title;
    }

    /**
     * Set content
     *
     * @param string $content
     * @return Post
     */
    public function setContent($content)
    {
        $this-&gt;content = $content;

        return $this;
    }

    /**
     * Get content
     *
     * @return string 
     */
    public function getContent()
    {
        return $this-&gt;content;
    }

    /**
     * Set createdAt
     *
     * @param \DateTime $createdAt
     * @return Post
     */
    public function setCreatedAt($createdAt)
    {
        $this-&gt;createdAt = $createdAt;

        return $this;
    }

    /**
     * Get createdAt
     *
     * @return \DateTime 
     */
    public function getCreatedAt()
    {
        return $this-&gt;createdAt;
    }

    /**
     * Set updatedAt
     *
     * @param \DateTime $updatedAt
     * @return Post
     */
    public function setUpdatedAt($updatedAt)
    {
        $this-&gt;updatedAt = $updatedAt;

        return $this;
    }

    /**
     * Get updatedAt
     *
     * @return \DateTime 
     */
    public function getUpdatedAt()
    {
        return $this-&gt;updatedAt;
    }
}

</pre>

<h2 id="configurando-a-entidade">Configurando a entidade</h2>

<p>Vamos fazer algumas modificações.</p>

<p>Daremos o nome &#8220;post&#8221; pra nossa tabela quando ela for criada, para isso temos que configurar via annotation para que o Doctrine saiba. Para fazer isso vamos adicionar na linha 10 a annotation correspondente:</p>

<p>Obs: As annotations do Doctrine, começam com &#8220;@ORM&amp;#8221;, o restante é documentação…</p>

<p>Verifique a alteração na linha 10, vamos inserir: (name=”post”).</p>

<p>Caso não façamos essa alteração, não ocorrerá erro, porém por padrão o Doctrine criará uma tabela com o nome da classe &#8220;Post&#8221;, com a letra “P” maiúscula.</p>

<pre class="lang-php">/**
 * Post
 *
 * @ORM\Table(name="post")
 * @ORM\Entity
 */
class Post
{
...
</pre>

<p>Mudaremos também o nome da coluna &#8220;createdAt&#8221; para &#8220;creadet_at&#8221; na linha 41 de nossa entidade, no caso do código abaixo, a linha 4.</p>

<pre class="lang-php">/**
 * @var \DateTime
 *
 * @ORM\Column(name="created_at", type="datetime")
 */
 private $createdAt;
...
</pre>

<p>E a linha 48, de &#8220;updatedAt&#8221; para &#8220;updated_at&#8221;, no código abaixo a linha 4.</p>

<pre class="lang-php">/**
 * @var \DateTime
 *
 * @ORM\Column(name="updated_at", type="datetime")
 */
 private $updatedAt;
...
</pre>

<p>Precisamos que, ao criarmos nosso post, seja inserido automaticamente a data de criação, e a data de atualização, para isso vamos criar um método construtor em nossa entidade, veja abaixo:</p>

<pre class="lang-php">/**
 * Construct
 */
 public function __construct()
 {
    $this-&gt;createdAt = new \DateTime();
    $this-&gt;updatedAt = new \DateTime();
 }
</pre>

<h2 id="validando">Validando</h2>

<p>Agora vamos fazer uma validação, para que nossos campos &#8220;title&#8221; e &#8220;content&#8221;, não aceitem conteúdos nulos, em brancos. Para isso chamaremos a classe Constraints do Symfony, dando um &#8220;use&#8221; nesse objeto em nossa entidade, por padrão daremos o apelido de Assert para Constraints. Veja na linha 06:</p>

<pre class="lang-php">&lt;?php

namespace Tableless\ModelBundle\Entity;

use Doctrine\ORM\Mapping as ORM;
use Symfony\Component\Validator\Constraints as Assert;

/**
 * Post
 *
 * @ORM\Table(name="post")
 * @ORM\Entity
 */
class Post
{
</pre>

<p>Para que a validação seja feita colocaremos a annotation &#8220;@Assert\NotBlank&#8221; nos campos que queremos, veja na linha 5 e na linha 13:</p>

<pre class="lang-php">/**
 * @var string
 *
 * @ORM\Column(name="title", type="string", length=255)
 * @Assert\NotBlank
 */
 private $title;

 /**
 * @var string
 *
 * @ORM\Column(name="content", type="text")
 * @Assert\NotBlank
 */
 private $content;
</pre>

<p>Pronto! Nossa entidade Post está criada e configurada, porém faremos modificações no fututo para que ela se adeque melhor em nosso projeto.</p>

<h2 id="gerando-crud-com-doctrine-orm">Gerando CRUD com Doctrine ORM</h2>

<p>Agora que nossa entidade está concluída, vamos fazer um CRUD, para que possamos inserir, atualizar, visualizar e deletar nossos posts.</p>

<p>Porém antes, precisamos criar nossas tabelas, para fazer isso, vamos voltar para o terminal e digitar:</p>

<pre class="lang-bash">$ php app/console doctrine:schema:create
</pre>

<p>Receberemos a resposta do console:</p>

<p>&#8220;ATENÇÃO: Esta operação não deve ser executado em um ambiente de produção.</p>

<p>Criação de esquema de banco de dados&#8230;</p>

<p>Esquema de banco de dados criado com sucesso!&#8221;</p>

<pre class="lang-bash">ATTENTION: This operation should not be executed in a production environment.

Creating database schema...
Database schema created successfully!
</pre>

<p>Vamos ao CRUD! Para fazer um CRUD com Doctrine, é extremamente fácil, vamos digitar no terminal:</p>

<pre class="lang-bash">$ php app/console generate:doctrine:crud
</pre>

<p>Ao digitarmos o comando acima e darmos o enter, entramos no assistente para criarmos nosso CRUD, e ele nos pede para que informemos a entidade que queremos criar o CRUD, então digitamos: TablelessModelBundle:Post</p>

<pre class="lang-bash">$ The Entity shortcut name: TablelessModelBundle:Post
</pre>

<p>Logo após, nos pergunta se queremos gerar as ações de &#8220;gravação&#8221;, ele nos indica [não], porém nós queremos, então digitamos &#8220;yes&#8221;.</p>

<pre class="lang-bash">$ Do you want to generate the "write" actions [no]? yes
</pre>

<p>Nos pergunta como vamos configurar nosso CRUD, e nos indica [annotation], só damos um enter para prosseguir.</p>

<pre class="lang-bash">$ Configuration format (yml, xml, php, or annotation) [annotation]:
</pre>

<p>Após o enter, nos pergunta como vai ser a rota que vamos usar, e nos indica [/post], vamos usar essa mesma, damos um enter.</p>

<pre class="lang-bash">$ Routes prefix [/post]:
</pre>

<p>Nos pergunta se confirmamos a geração, e nos indica [yes], sim queremos, damos enter para prosseguir.</p>

<pre class="lang-bash">$ Do you confirm generation [yes]?
</pre>

<p>Pronto! CRUD criado, simples não!</p>

<p>Nesse momento vamos fazer uma configuração somente para vermos nossa aplicação rodando, porém não vamos usar essa rota, é somente para vermos se está tudo certo. Entre no arquivo app/config/route.yml e vamos adicionar a rota desse CRUD:</p>

<pre class="lang-php">tableless_model:
    resource: "@TablelessModelBundle/Controller/"
    type:     annotation
    prefix:   /
</pre>

<p>Agora vamos rodar nosso aplicação pelo console:</p>

<pre class="lang-bash">$ php app/console server:run
</pre>

<p>E vamos entrar no navegador com a url:</p>

<p><a href="http://127.0.0.1:8000/post/">http://127.0.0.1:8000/post/</a></p>

<p>Para inserirmos um novo post, é só dar um clique, em &#8220;Create a new entry&#8221;.</p>

<p>Eu inseri um post, com um texto “Lorem Ipsum”, apenas para reprodução das páginas, veja o resultado abaixo:</p>

<p>Lista de posts = url: <a href="http://127.0.0.1:8000/post/">http://127.0.0.1:8000/post/</a></p>

<p>Novo post = url: <a href="http://127.0.0.1:8000/post/new">http://127.0.0.1:8000/post/new</a></p>

<p>Ver o post = url: <a href="http://127.0.0.1:8000/post/1">http://127.0.0.1:8000/post/1</a></p>

<p>Editar post = url: <a href="http://127.0.0.1:8000/post/1/edit">http://127.0.0.1:8000/post/1/edit</a></p>

<p><a href="http://tableless.com.br/wp-content/uploads/2015/02/031.png"><img src="http://tableless.com.br/wp-content/uploads/2015/02/031.png" alt="Páginas criadas" width="750" height="403" class="alignnone size-full wp-image-47111" srcset="uploads/2015/02/031.png 750w, uploads/2015/02/031-259x139.png 259w, uploads/2015/02/031-400x215.png 400w" sizes="(max-width: 750px) 100vw, 750px" /></a></p>

<p>Ao navegar pelas páginas, verificará, que não tem estilização, porém está funcional, vamos fazer isso mais tarde, poderá verificar também seu banco de dados, e verá que foi criado um banco de dados com o nome &#8220;symfony&#8221;, nesse banco, encontrará a tabela &#8220;post&#8221; que criamos.</p>

<p><a href="http://tableless.com.br/wp-content/uploads/2015/02/021.png"><img src="http://tableless.com.br/wp-content/uploads/2015/02/021.png" alt="Table post no banco de dados" width="750" height="403" class="alignnone size-full wp-image-47098" srcset="uploads/2015/02/021.png 750w, uploads/2015/02/021-259x139.png 259w, uploads/2015/02/021-400x215.png 400w" sizes="(max-width: 750px) 100vw, 750px" /></a></p>

<h2 id="concluindo">Concluindo</h2>

<p>Uma observação importante, estamos criando nossos códigos por linha de comando usando o console, é uma forma de mostrar a agilidade e produtividade, que o Symfony e o Doctrine nos permite, porém para entender o mínimo, o funcionamento do Symfony, ou de qualquer outro framework PHP, é de extrema importância saber PHP Orientado a Objetos, padrão MVC e outros Design Patterns. Fazer a reprodução codificando, sem usar o console, é uma boa forma de aprender e entender o funcionamento do Symfony.</p>

<p>Este projeto <a href="https://github.com/candidosouza/tableless" title="GitHub do projeto" target="_blank">encontra-se no gitHub</a>.</p>

    </article>

<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = '';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
  </section>


  <aside class="tb-aside">
    Banner
  </aside>

</section>


<footer id="tb-footer">
    <div class="tb-container">
    <ul class="tb-social-links">
        <li><a href="http://facebook.com/tablelessbr">Facebook</a></li>
        <li><a href="http://twitter.com/tableless">Twitter</a></li>
        <li><a href="http://tableless.com.br/feed">RSS</a></li>
        <li><a href="http://medium.com/tableless">Medium</a></li>
    </ul>
    <nav class="tb-footer-nav">
        <a href="">Contato</a>
        <a href="">Anuncie</a>
        <a href="">Seja um Autor</a>
        <a href="">Fazemos código front-end</a>
    </nav>

    <p class="tb-for-community">
        Escrito pela e para a comunidade web brasileira. <a href="">Ajude</a>.
    </p>
    </div>
</footer>
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script>
$(document).ready(function() {
  $('pre').each(function(i, block) {
    hljs.highlightBlock(block);
  });
})</script>


</body>
</html>

