<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cakephp on Tableless</title>
    <link>http://tableless.com.br/tags/cakephp/index.xml</link>
    <description>Recent content in Cakephp on Tableless</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <atom:link href="http://tableless.com.br/tags/cakephp/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Formul√°rio sem Model no CakePHP 3.x</title>
      <link>http://tableless.com.br/formulario-sem-model-no-cakephp-3-x/</link>
      <pubDate>Tue, 16 Jun 2015 00:00:00 +0000</pubDate>
      
      <guid>http://tableless.com.br/formulario-sem-model-no-cakephp-3-x/</guid>
      <description>

&lt;p&gt;Requisitos do artigos:&lt;/p&gt;

&lt;p&gt;&amp;#8211; Ter o CakePHP 3 instalado ( &lt;a href=&#34;https://medium.com/@eabreusantos/instalando-o-cakephp-3-0-2f2a155cb8b1&#34; target=&#34;_blank&#34;&gt;Artigo de como instalar o Cakephp 3.x&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;O que aprenderemos:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Como trabalhar com formul√°rios que n√£o necessitam de um Model.&lt;/li&gt;
&lt;li&gt;Criar uma p√°gina de contato.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;formul√°rios&#34;&gt;Formul√°rios&lt;/h3&gt;

&lt;p&gt;Na maioria das vezes, trabalhamos com formul√°rios relacionados a um Model para persistir dados. Outras vezes precisamos validar os dados de um formul√°rio onde n√£o h√° persist√™ncia, como √© no caso de um Formul√°rio de Contato. Para tal tarefa, o CakePHP 3.x nos disponibiliza o que chamamos de &lt;strong&gt;Modelless Forms&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Para come√ßar, precisamos criar uma pasta chamada &amp;#8216;Forms&amp;#8217; dentro do diret√≥rio &amp;#8216;app\src&amp;#8217;. Para exemplificar vamos assumir que iremos criar um formul√°rio de contato b√°sico com nome, email e mensagem.&lt;/p&gt;

&lt;p&gt;Na pasta Forms, crie um arquivo chamado &amp;#8216;ContactForm.php&amp;#8217; com o seguinte conte√∫do:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;namespace App\Form;
use Cake\Form\Form;
use Cake\Form\Schema;
use Cake\Validation\Validator;
class ContactForm extends Form
{
 /*
 * Cria schema do formul√°rio
 * @param Schema object
 * @return Schema object
 */
 protected function _buildSchema(Schema $schema)
{
 return $schema-&amp;gt;addField(&#39;name&#39;, &#39;string&#39;)
 -&amp;gt;addField(&#39;email&#39;, [&#39;type&#39; =&amp;gt; &#39;string&#39;])
 -&amp;gt;addField(&#39;body&#39;, [&#39;type&#39; =&amp;gt; &#39;text&#39;]);
}
/*
*Add regras de valida√ß√£o aos campos do formul√°rio
* @param Validator object
* @return Validator object
*/
protected function _buildValidator(Validator $validator)
{
 return $validator-&amp;gt;add(&#39;name&#39;, &#39;length&#39;, [
 &#39;rule&#39; =&amp;gt; [&#39;minLength&#39;, 10],
 &#39;message&#39; =&amp;gt; &#39;Campo nome √© obrigat√≥rio&#39;
 ])-&amp;gt;add(&#39;email&#39;, &#39;format&#39;, [
 &#39;rule&#39; =&amp;gt; &#39;email&#39;,
 &#39;message&#39; =&amp;gt; &#39;Endere√ßo de e-mail inv√°lido&#39;,
 ]);
}
/*
* Envia e-mail com os dados do contato
* @param array $data dados da requisi√ß√£o
* @return bool true caso tenha enviado o e-mail com sucesso
*/
protected function _execute(array $data)e
{
// Send an email.
return true;
}
}&lt;/pre&gt;

&lt;p&gt;Linha 1:4‚Ää‚Äî‚ÄäDeclaramos o namespace e importamos classes que iremos utilizar.&lt;/p&gt;

&lt;p&gt;Linha 5‚Ää‚Äî‚ÄäDeclara√ß√£o da classe, obrigat√≥rio o sufixo Form tanto na declara√ß√£o da classe como no nome do arquivo, Modelless Forms devem obrigatoriamente estender da classe Form.&lt;/p&gt;

&lt;p&gt;Linha 12:17‚Ää‚Äî‚ÄäM√©todo &amp;#8216;&lt;strong&gt;_buildSchema&lt;/strong&gt;&amp;#8216;, recebe como par√¢metro um objeto do tipo Schema. √â usado para definir o esquema de dados que ser√° utilizado pelo FormHelper para criar o formul√°rio html. √â poss√≠vel definir o tipo do campo, tamanho do campo e precis√£o. Este m√©todo deve retornar o pr√≥prio objeto Schema.&lt;/p&gt;

&lt;p&gt;Linha 23:32‚Ää‚Äî‚ÄäM√©todo &lt;strong&gt;&amp;#8216;_buildValidator&lt;/strong&gt;&amp;#8216;, recebe como par√¢metro um objeto do tipo Validator. √â usado para definir o esquema de valida√ß√£o do formul√°rio quando processado. √â poss√≠vel definir v√°rias regras de valida√ß√£o para mesmo campo. Este m√©todo deve retornar o pr√≥prio objeto Validator. Veja mais regras e op√ß√µes em: &lt;a href=&#34;http://book.cakephp.org/3.0/en/core-libraries/validation.html&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://book.cakephp.org/3.0/en/core-libraries/validation.html&#34;&gt;http://book.cakephp.org/3.0/en/core-libraries/validation.html&lt;/a&gt;&lt;/a&gt;. Em breve irei publicar um artigo sobre Valida√ß√£o de dados.&lt;/p&gt;

&lt;p&gt;Linha 38:~‚Ää‚Äî‚ÄäM√©todo &amp;#8216;&lt;strong&gt;_execute&lt;/strong&gt;&amp;#8216;, recebe como par√¢metro um array contendo os dados da requisi√ß√£o ou no caso os dados do formul√°rio que o usu√°rio preencheu. O retorno deste m√©todo √© de acordo com a implementa√ß√£o.&lt;/p&gt;

&lt;h3 id=&#34;processando-o-formul√°rio&#34;&gt;Processando o Formul√°rio&lt;/h3&gt;

&lt;p&gt;Uma vez definida a classe do formul√°rio, temos agora de processa-lo, para isto podemos utilizar um Controller. Na pasta &amp;#8216;app\src\Controller&amp;#8217; crie um arquivo chamado &amp;#8216;ContactController.php&amp;#8217; com o seguinte conte√∫do.&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;namespace App\Controller;
use App\Controller\AppController;
use App\Form\ContactForm;
class ContactController extends AppController
{
  /*
  * Exibe e processa o formul√°rio de contato caso seja uma requisi√ß√£o post
  * @return void\Response
  */
public function index()
{
 $contact = new ContactForm();
 if ($this-&amp;gt;request-&amp;gt;is(&#39;post&#39;)) {
 if ($contact-&amp;gt;execute($this-&amp;gt;request-&amp;gt;data)) {
 $this-&amp;gt;Flash-&amp;gt;success(&#39;Mensagem enviado, aguarde nosso retorno.&#39;);
} else {
 $this-&amp;gt;Flash-&amp;gt;error(&#39;Ocorreu um problema ao enviar sua mensagem.&#39;);
}
}
 $this-&amp;gt;set(&#39;contact&#39;, $contact);
}
}&lt;/pre&gt;

&lt;p&gt;Linha 13‚Ää‚Äî‚ÄäVerificamos se a requisi√ß√£o √© do tipo &amp;#8216;POST&amp;#8217;.&lt;/p&gt;

&lt;p&gt;Linha 14‚Ää‚Äî‚ÄäCaso seja, tentamos processar o formul√°rio executando o m√©todo &amp;#8216;execute()&amp;#8217; que recebe como par√¢metro os dados da requisi√ß√£o que estar√° dispon√≠vel no m√©todo &amp;#8216;_execute&amp;#8217; do Form. Ao executar o m√©todo &amp;#8216;execute&amp;#8217;, automaticamente o formul√°rio ir√° tentar validar os dados de acordo com sua implementa√ß√£o do m√©todo &amp;#8216;_buildValidator&amp;#8217;, se a valida√ß√£o passar, s√≥ ent√£o o m√©todo &amp;#8216;_execute&amp;#8217; √© chamado.&lt;/p&gt;

&lt;p&gt;Linha 20‚Ää‚Äî‚ÄäEnvia o objeto do formul√°rio √† view para ser utilizado no FormHelper.&lt;/p&gt;

&lt;h3 id=&#34;capturando-erros-de-valida√ß√£o&#34;&gt;Capturando erros de valida√ß√£o&lt;/h3&gt;

&lt;p&gt;Para capturar os erros de valida√ß√£o, utilize o m√©todo &amp;#8216;errors()&amp;#8217; do objeto do formul√°rio, veja abaixo um exemplo:&lt;/p&gt;

&lt;pre class=&#34;lang-php &#34;&gt;// Na action do controller
public function index()
{
 $contact = new ContactForm();
 $erros = [];
 if ($this-&amp;gt;request-&amp;gt;is(&#39;post&#39;)) {
 if ($contact-&amp;gt;execute($this-&amp;gt;request-&amp;gt;data)) {
 $this-&amp;gt;Flash-&amp;gt;success(&#39;Mensagem enviado, aguarde nosso retorno.&#39;);
} else {
//Captura &lt;span class=&#34;hiddenGrammarError&#34;&gt;erros
 $erros&lt;/span&gt; = $contact-&amp;gt;errors();
 $this-&amp;gt;Flash-&amp;gt;error(&#39;Ocorreu um problema ao enviar sua mensagem.&#39;);
}
}
 $this-&amp;gt;set(&#39;contact&#39;, $contact);
 $this-&amp;gt;set(&#39;erros&#39;,$erros);
}&lt;/pre&gt;

&lt;p&gt;O m√©todo &amp;#8216;errors&amp;#8217; retorna um array com a listagem de campos que n√£o est√£o v√°lidos, sendo os √≠ndices os nomes dos campos e os valores as mensagens de erro.&lt;/p&gt;

&lt;h3 id=&#34;exibi√ß√£o-do-formul√°rio&#34;&gt;Exibi√ß√£o do Formul√°rio&lt;/h3&gt;

&lt;p&gt;Para que o formul√°rio seja exibido para usu√°rio, crie uma view no diret√≥rio &amp;#8216;app\src\View\Template\Contact&amp;#8217; com o nome &amp;#8216;index.ctp&amp;#8217; e o seguinte conte√∫do:&lt;/p&gt;

&lt;p&gt;Por enquanto √© s√≥ galera, em breve irei publicar como enviar os dados do formul√°rio para um e-mail.&lt;/p&gt;

&lt;p&gt;Qualquer d√∫vida, estou a disposi√ß√£o para ajudar.&lt;/p&gt;

&lt;p&gt;Abra√ßos!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Instalando o CAKEPHP 3.0 via Composer</title>
      <link>http://tableless.com.br/instalando-o-cakephp-3-0-via-composer/</link>
      <pubDate>Sun, 07 Jun 2015 00:00:00 +0000</pubDate>
      
      <guid>http://tableless.com.br/instalando-o-cakephp-3-0-via-composer/</guid>
      <description>

&lt;p&gt;Requisitos do tutorial:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;PHP instalado e configurado&lt;/li&gt;
&lt;li&gt;Ambiente Linux&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;No dia 22/03/2015 foi disponibilizado para download no &lt;a href=&#34;http://cakephp.org&#34;&gt;site do CakePHP&lt;/a&gt; a &lt;a href=&#34;http://book.cakephp.org/3.0/en/installation.html&#34;&gt;vers√£o 3.0 do framework para PHP CakePHP&lt;/a&gt;. J√° utilizamos a vers√£o 2.x em projetos aqui na empresa e tivemos bons resultados.&lt;/p&gt;

&lt;p&gt;Com o lan√ßamento desta nova vers√£o, muita coisa mudou: um novo ORM foi lan√ßado; o uso de namespaces foi adotado; entre outras features que iremos abordar em outras publica√ß√µes.&lt;/p&gt;

&lt;p&gt;Neste artigo irei realizar um passo a passo da instala√ß√£o do Cakephp 3.0 &lt;a href=&#34;http://tableless.com.br/composer-para-iniciantes/&#34;&gt;utilizando o Composer&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;o-que-√©-o-composer&#34;&gt;O que √© o Composer&lt;/h3&gt;

&lt;p&gt;O Composer √© o gerenciador de depend√™ncias do PHP, com ele √© poss√≠vel definir uma lista de bibliotecas que sua aplica√ß√£o necessita para funcionar, al√©m de poder definir requisitos como, vers√£o do PHP, extensions etc.&lt;/p&gt;

&lt;p&gt;Para aprender mais sobre o Composer, listei alguns artigos abaixo:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;http://tableless.com.br/composer-para-iniciantes/&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://blog.thiagobelem.net/gerenciando-dependencias-com-o-composer/&#34;&gt;http://blog.thiagobelem.net/gerenciando-dependencias-com-o-composer/&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://tableless.com.br/composer-para-iniciantes/&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://tableless.com.br/composer-para-iniciantes/&#34;&gt;http://tableless.com.br/composer-para-iniciantes/&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://getcomposer.org ( site oficial)&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://getcomposer.org&#34;&gt;http://getcomposer.org&lt;/a&gt; ( site oficial)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;instalando-o-composer&#34;&gt;Instalando o Composer&lt;/h3&gt;

&lt;p&gt;Na pasta onde ir√° ficar localizada a aplica√ß√£o, abra o terminal e digite o seguinte:&lt;/p&gt;

&lt;pre class=&#34;lang-bash&#34;&gt;#Caso tenha o Curl instalado
curl -s https://getcomposer.org/installer | php
## ou ##
#Caso n√£o possua o Curl instalado
php -r &#34;readfile(&#39;https://getcomposer.org/installer&#39;);&#34; | php&lt;/pre&gt;

&lt;p&gt;Documenta√ß√£o do comando usado: &lt;a href=&#34;http://php.net/manual/pt_BR/features.commandline.options.php%20http://curl.haxx.se/mail/lib-2004-07/0017.html&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://php.net/manual/pt_BR/features.commandline.options.php&#34;&gt;http://php.net/manual/pt_BR/features.commandline.options.php&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://php.net/manual/pt_BR/features.commandline.options.php%20http://curl.haxx.se/mail/lib-2004-07/0017.html&#34;&gt;http://curl.haxx.se/mail/lib-2004-07/0017.html&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;instalando-o-cakephp-3&#34;&gt;Instalando o CakePHP 3&lt;/h3&gt;

&lt;h4 id=&#34;requisitos-m√≠nimos&#34;&gt;Requisitos M√≠nimos&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;HTTP Server. Exemplo: Apache, Ngix. Com mod_rewrite habilitado de prefer√™ncia, mas n√£o √© obrigat√≥rio.&lt;/li&gt;
&lt;li&gt;PHP 5.4.16 ou maior&lt;/li&gt;
&lt;li&gt;extens√£o mbstring&lt;/li&gt;
&lt;li&gt;extens√£o intl (Como instalar/habilitar: &lt;a href=&#34;http://goo.gl/qz6tqT&#34;&gt;http://goo.gl/qz6tqT&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Para instalar o framework, na pasta do projeto onde tamb√©m o Composer foi instalado e digite o seguinte comando:&lt;/p&gt;

&lt;pre class=&#34;lang-bash&#34;&gt;#Install cakephp3
composer create-project --prefer-dist cakephp/app [nome da app]&lt;/pre&gt;

&lt;p&gt;Documenta√ß√£o do comando usado: &lt;a href=&#34;https://getcomposer.org/doc/03-cli.md#create-project&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;https://getcomposer.org/doc/03-cli.md#create-project&#34;&gt;https://getcomposer.org/doc/03-cli.md#create-project&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Para testar se a aplica√ß√£o foi instalada com sucesso, acesse a pasta da aplica√ß√£o, no caso o mesmo nome que digitou em [nome da app] e digite o seguinte comando:&lt;/p&gt;

&lt;pre class=&#34;lang-bash&#34;&gt;#Inicia built-in server
./bin/cake server&lt;/pre&gt;

&lt;p&gt;Documenta√ß√£o do comando usado: &lt;a href=&#34;http://book.cakephp.org/3.0/en/console-and-shells.html&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://book.cakephp.org/3.0/en/console-and-shells.html&#34;&gt;http://book.cakephp.org/3.0/en/console-and-shells.html&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ap√≥s, se tudo ocorrer bem, uma mensagem ser√° exibida no terminal informando que o servidor embutido foi iniciado e que se encontra dispon√≠vel no endere√ßo: &lt;a href=&#34;http://localhost:8765/&#34;&gt;http://localhost:8765/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Por enquanto √© s√≥ galera, caso tenham alguma d√∫vida ou problema durante a instala√ß√£o, ficarei feliz em ajudar.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CakePHP conven√ß√µes de nomenclatura e o poderoso Inflector!</title>
      <link>http://tableless.com.br/cakephp-convencoes-de-nomenclatura-e-o-poderoso-inflector/</link>
      <pubDate>Thu, 19 Mar 2015 00:00:00 +0000</pubDate>
      
      <guid>http://tableless.com.br/cakephp-convencoes-de-nomenclatura-e-o-poderoso-inflector/</guid>
      <description>

&lt;p&gt;Geralmente eu tenho problemas para encontrar os nomes corretos para os meus controllers, views, models e tabelas. Talvez a tarefa mais dif√≠cil de todo programador seja nomear as coisas. Quem nunca ficou indeciso por causa do nome de uma fun√ß√£o ou de uma vari√°vel? Eu busco sempre permanecer o projeto todo em ingl√™s.&lt;/p&gt;

&lt;p&gt;Bem, &lt;strong&gt;CakePHP&lt;/strong&gt; faz um monte de trabalho tedioso e repetitivo para voc√™, para que voc√™ possa se concentrar melhor nas regras do negocio. Mas o CakePHP depende de voc√™! Ele se agarrar √†s suas conven√ß√µes de nomenclatura, por isso √© importante ter aten√ß√£o em nomes de &lt;strong&gt;tabelas&lt;/strong&gt;, &lt;strong&gt;controllers&lt;/strong&gt;, &lt;strong&gt;models&lt;/strong&gt;..&lt;/p&gt;

&lt;p&gt;Eu mesmo j√° tive diversos problemas com nomenclaturas e passei por muita dor de cabe√ßa! Acredite.. O CakePHP espera que voc√™ converta corretamente esse problema entre singular, plural, etc üòâ&lt;/p&gt;

&lt;p&gt;As Models s√£o singular. Ex: &lt;strong&gt;BigPerson&lt;/strong&gt; e &lt;strong&gt;ReallyBigPerson&lt;/strong&gt; s√£o exemplos de nomes de modelos convencionais. Os nomes das tabelas correspondentes a model do CakePHP s√£o plurais e sublinhado. As tabelas para as models acima mencionadas seriam &lt;strong&gt;big_people&lt;/strong&gt;, &lt;strong&gt;really_big_people&lt;/strong&gt;, respectivamente.&lt;/p&gt;

&lt;p&gt;Aparentemente CakePHP converte substantivos irregulares corretamente e eu me pergunto: Como? Ser√° que ela tem um look-up table enorme para todos eles? Bem, n√£o! Em vez disso, ele faz algumas coisas muito sofisticadas em uma classe chamada &lt;strong&gt;cake/libs/ inflector.php,&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;com um monte de correspond√™ncias de regex e muito mais!&lt;/p&gt;

&lt;h2 id=&#34;m√©todos&#34;&gt;M√©todos&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pluralize&lt;/strong&gt;: Converte para o plural: Apple, Man ‚Üí Apples, Men&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;singularize&lt;/strong&gt;: Converte para o singular: Apples, Men ‚Üí Apple, Man&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;camelize&lt;/strong&gt;: Converte underscored hadron_collider ‚Üí hadronCollider&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;underscore&lt;/strong&gt;: Converte para underscored adronCollider ‚Üí hadron_collider&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;humanize&lt;/strong&gt;: Converte unserscore para stirng com Captalize devine_intervention ‚Üí Devine Intervention&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;tableize&lt;/strong&gt;: Converte para underscore e plural MajorFeatureThing ‚Üí major_feature_things&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;classify&lt;/strong&gt;: Converte para underscore com plural para string no singular major_feature_things ‚Üí MajorFeatureThing&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;variable&lt;/strong&gt;: Converte de underscored plural ou singular para singular e lowercase. major_feature_things ‚Üí majorFeatureThing&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;slug&lt;/strong&gt;: Converte caracteres especias/espa√ßos em underscore de qualquer formata√ß√£o. Este m√©todo √© UTF-8 encoding! apple pur√©e ‚Üí apple_puree&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Agora que voc√™ tem uma ideia do que o Inflector pode fazer por voc√™, vamos explorar cada um desses m√©todos em detalhes.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Inflector::pluralize();&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O m√©todo pluralize () recebe uma palavra no singular (string) e retorna a vers√£o plural da mesma. Aqui est√£o alguns exemplos:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;Inflector::pluralize(&#39;Apple&#39;); // returns &#34;Apples&#34;
Inflector::pluralize(&#39;Menu&#39;); // returns &#34;Menus&#34;
Inflector::pluralize(&#39;News&#39;); // returns &#34;News&#34;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Inflector::singularize()&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O m√©todo singularize() recebe uma palavra no plural (string) e retorna a vers√£o no singular dele. Aqui est√£o alguns exemplos:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;Inflector::singularize(&#39;Houses&#39;); // returns &#34;House&#34;
Inflector::singularize(&#39;Bananas&#39;); // returns &#34;Banana&#34;
Inflector::singularize(&#39;Men&#39;); // returns &#34;Man&#34;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Inflector::camelize ()&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Voc√™ pode passar um m√©todo ou a ou uma palavra under_scored para o camelize () e ele&lt;/p&gt;

&lt;p&gt;ir√° retornar esta palavra FooBar ou fooBar(se voc√™ passar false como o segundo argumento). Alguns exemplos:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;Inflector::camelize(&#39;foo_bar&#39;); // returns &#34;FooBar&#34; 
Inflector::camelize(&#39;foo_bar&#39;, false); // returns &#34;fooBar&#34;
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Inflector::underscore()&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Este o nome j√° diz.&lt;/p&gt;

&lt;p&gt;O m√©todo underscore () tem basicamente uma palavra e converte os espa√ßos dela em &amp;#8220;_&amp;#8221; , e tamb√©m converte os caracteres especiais em caracteres normais. Ex:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;Inflector::underscore(&#39;TestField&#39;) // returns test_field
Inflector::underscore(&#39;FeineApfel&#39;) // returns feine_aepfel
&lt;/pre&gt;

&lt;p&gt;Este √© o meu preferido!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Inflector::slug()&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O m√©todo slug () recebe uma string e cria uma representa√ß√£o &amp;#8220;slugged&amp;#8221; dele.&lt;/p&gt;

&lt;p&gt;Isto significa basicamente que todos os espa√ßos ser√£o substitu√≠dos por um determinado caractere (o padr√£o √© &amp;#8220;-&amp;#8220;),&lt;/p&gt;

&lt;p&gt;o que n√£o for palavra ser√° removido e os caracteres com acentos como &amp;#8220;√°√Å√©√ç√ì√ö&amp;#8221; ser√° traduzida para a sua representa√ß√£o ASCII.&lt;/p&gt;

&lt;p&gt;Aqui est√£o alguns exemplos:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;Inflector::slug(&#39;The truth - and- more- news&#39;); // returns &#34;the-truth-and-more-news&#34;
Inflector::slug(&#39;!@$#exciting stuff! - what !@-# was that?&#39;); // returns &#34;exciting-stuff-what-was-that&#34;
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Inflector::humanize()&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O m√©todo humanize () recebe uma palavra sublinhada, remove um determinado seperator (padr√£o para &amp;#8220;_&amp;#8221;) e uppercases os primeiros caracteres das palavras. Alguns exemplos dos testes principais:&lt;/p&gt;

&lt;pre class=&#34;lang:php decode:true &#34;&gt;Inflector::humanize(&#39;posts&#39;); // returns &#34;Posts&#34;
Inflector::humanize(&#39;posts_tags&#39;); // returns &#34;Posts Tags&#34;
Inflector::humanize(&#39;file_systems&#39;); // returns  &#34;File Systems&#34;&lt;/pre&gt;

&lt;p&gt;Estes s√£o os que eu achei mais importante ..&lt;/p&gt;

&lt;p&gt;Mas se voc√™ quiser ver todos os m√©todos veja na &lt;a href=&#34;http://book.cakephp.org/2.0/en/core-utility-libraries/inflector.html&#34;&gt;documenta√ß√£o aqui&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Adicione suas pr√≥prias regras&lt;/p&gt;

&lt;p&gt;Se voc√™ precisar, voc√™ pode adicionar suas pr√≥prias regras e / ou substituir regras padr√£o. As regras inflector::method() √© respons√°vel por isso e funciona como um setter ou getter para todas as regras armazenados. Os testes b√°sicos proporcionam um exemplo:&lt;/p&gt;

&lt;pre lang=&#34;php&#34;&gt;Inflector::rules(&#39;singular&#39;, array(&#39;/rata/&#39; =&amp;gt; &#39;\1ratus&#39;));
&lt;/pre&gt;

&lt;p&gt;Voc√™ tamb√©m pode adicionar translitera√ß√µes que mapeia caracteres espec√≠ficos ou acentuados de linguagem para os ASCII (que s√£o usados ‚Äã‚Äãpara criar slugs, por exemplo). Os teste no core tamb√©m oferecem um bom exemplo:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;$this-&amp;gt;assertNotEqual(Inflector::slug(&#39;J√òRGEN&#39;), &#39;JORGEN&#39;);
Inflector::rules(&#39;transliteration&#39;, array(&#39;/√ò/&#39; =&amp;gt; &#39;O&#39;));
$this-&amp;gt;assertEqual(Inflector::slug(&#39;J√òRGEN&#39;), &#39;JORGEN&#39;);
&lt;/pre&gt;

&lt;p&gt;Uma boa pr√°tica √© armazenar suas regras personalizadas em um arquivo de inicializa√ß√£o, de modo que eles est√£o imediatamente dispon√≠veis para a sua aplica√ß√£o quando estiver totalmente carregado.&lt;/p&gt;

&lt;p&gt;Minha dica √© criar dentro do arquivo Bootstrap =D ou at√© mesmo um helper..&lt;/p&gt;

&lt;p&gt;Agora, v√°! V√° e diga a todos os seus amigos sobre a sua nova descoberta! \o/&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Criando uma galeria de imagens com administra√ß√£o em CakePHP, Fancybox e WideImage)</title>
      <link>http://tableless.com.br/criando-uma-galeria-de-imagens-com-administracao-em-cakephp-fancybox-e-wideimage/</link>
      <pubDate>Sun, 27 Apr 2014 00:00:00 +0000</pubDate>
      
      <guid>http://tableless.com.br/criando-uma-galeria-de-imagens-com-administracao-em-cakephp-fancybox-e-wideimage/</guid>
      <description>

&lt;p&gt;Eu sou da opini√£o que todo bom desenvolvedor frontend tem que ter pelo menos uma no√ß√£o de backend, e o contr√°rio tamb√©m tem que acontecer, √© comum as pessoas virem me perguntar como que faz pra fazer o Fancybox funcionar no CakePHP, ou como que eu integro um plugin para Jquery no site, puxa, a maioria das vezes √© adicionar um seletor, chamar o javascript no Html e configurar de acordo com a documenta√ß√£o, vamos ver se simplifico pra voc√™s.&lt;/p&gt;

&lt;p&gt;A ideia √© criar uma galeria de imagens com painel de administra√ß√£o e separada por √°lbuns. Iremos instalar tamb√©m o DebugKit pra medir o uso de mem√≥ria do CakePHP e saber se a nossa aplica√ß√£o est√° pesada ou n√£o.&lt;/p&gt;

&lt;h3 id=&#34;para-quem-o-cakephp-√©-interessante&#34;&gt;Para quem o CakePHP √© interessante?&lt;/h3&gt;

&lt;p&gt;O CakePHP √© interessante para devs backend que precisam ganhar tempo ao desenvolver ou querem entender como funciona o esquema de MVC.&lt;/p&gt;

&lt;p&gt;Tamb√©m √© interessante para os devs frontend que precisam automatizar algumas tarefas, entender como √© o mundo do backend e at√© ganhar tempo com o sistema de temas, layouts e view do CakePHP (camada V).&lt;/p&gt;

&lt;h3 id=&#34;o-que-vamos-usar&#34;&gt;O que vamos usar?&lt;/h3&gt;

&lt;p&gt;Vamos precisar de:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Uma c√≥pia do CakePHP (&lt;a href=&#34;http://cakephp.org/&#34;&gt;http://cakephp.org/&lt;/a&gt;, a direita tem uma palavra grande escrito Download com o link para a vers√£o est√°vel mais recente.)&lt;/li&gt;
&lt;li&gt;Uma c√≥pia do Fancybox (&lt;a href=&#34;http://fancyapps.com/fancybox/#license&#34;&gt;http://fancyapps.com/fancybox/#license&lt;/a&gt;, bot√£ozinho azul!)&lt;/li&gt;
&lt;li&gt;O DebugKit (&lt;a href=&#34;https://github.com/cakephp/debug_kit&#34;&gt;https://github.com/cakephp/debug_kit&lt;/a&gt;, na lateral direita tem um link chamado ‚ÄúDownload ZIP‚Äù)&lt;/li&gt;
&lt;li&gt;O WideImage (&lt;a href=&#34;http://wideimage.sourceforge.net/download/&#34;&gt;http://wideimage.sourceforge.net/download/&lt;/a&gt;, aonde est√° escrito ‚Äúdownload it‚Äù, baixe s√≥ o lib (terceiro da lista))&lt;/li&gt;
&lt;li&gt;Um desenvolvedor web&lt;/li&gt;
&lt;li&gt;√Ågua&lt;/li&gt;
&lt;li&gt;P√≥ de caf√©&lt;/li&gt;
&lt;li&gt;Uma cafeteira&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;modo-de-preparo&#34;&gt;Modo de preparo&lt;/h3&gt;

&lt;p&gt;Primeiro voc√™ pega a √°gua, o p√≥ de caf√© e a cafeteira pra fazer um caf√© esperto e acompanhar este tutorial.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Preparando o ambiente!&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Em seguida, descompacte o CakePHP no seu servidor local (eu uso o Xampp: &lt;a href=&#34;https://www.apachefriends.org/pt_br/index.html&#34;&gt;https://www.apachefriends.org/pt_br/index.html&lt;/a&gt;) para facilitar aqui.&lt;/li&gt;
&lt;li&gt;Descompacte o DebugKit na pasta app/Plugin do CakePHP e renomeie o diret√≥rio &lt;strong&gt;debug_kit-master&lt;/strong&gt; para &lt;strong&gt;DebugKit&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;O FancyBox vai em &lt;em&gt;app/webroot&lt;/em&gt;, mas apenas a pasta source, e renomeie para fancy.&lt;/li&gt;
&lt;li&gt;O WideImage pode ir em &lt;em&gt;app/Vendor/wideimage&lt;/em&gt; e dentro¬†os arquivos dele de forma que o WideImage.php fique dispon√≠vel em &lt;em&gt;app/Vendor/wideimage/WideImage.php&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Agora que temos todos os arquivos, vamos ativar o DebugKit pra poder ter as m√©tricas de uso de mem√≥ria, execu√ß√£o dos SQLs e outros dados.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Abra o arquivo &lt;em&gt;app/Config/bootstrap.php&lt;/em&gt; e cole o c√≥digo abaixo (cod.1) na linha 72&lt;/li&gt;
&lt;li&gt;Ap√≥s isso abra o AppController.php (em &lt;em&gt;app/Controller&lt;/em&gt;) e cole o bloco cod.2 na linha 35, entre as chaves ({}) da classe AppController.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Cod.1::&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;CakePlugin::load(&#39;DebugKit&#39;);&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Cod.2::&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public $components = array(
&#39;DebugKit.Toolbar&#39;,
&#39;Session&#39;
);
&lt;/pre&gt;

&lt;p&gt;Se acessar sua aplica√ß√£o agora vai ver que temos um pequeno bot√£o no canto superior direito, ao clicar nele voc√™ j√° tem acesso aos dados da sua aplica√ß√£o, em timer voc√™ v√™ o uso de mem√≥ria.&lt;/p&gt;

&lt;p&gt;Pra fechar, acesse o core.php em app/Config, procure e descomente a linha a seguir (aqui era a 152) removendo as barras do come√ßo (//)&lt;/p&gt;

&lt;pre&gt;Configure::write(&#39;Routing.prefixes&#39;, array(&#39;admin&#39;));&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Preparando a estrutura&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Pra come√ßar vamos precisar de um banco de dados (vamos usar o MySql), execute o c√≥digo abaixo (se quiser, use algo como PHPMyAdmin para ajudar) pra criar as tabelas:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod.3:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;-- --------------------------------------------------------

--
-- Estrutura da tabela `albuns`
--

CREATE TABLE IF NOT EXISTS `albuns` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `titulo` varchar(255) NOT NULL,
  `created` datetime NOT NULL,
  `modified` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;

-- --------------------------------------------------------

--
-- Estrutura da tabela `imagens`
--

CREATE TABLE IF NOT EXISTS `imagens` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` varchar(250) NOT NULL,
  `titulo` varchar(250) NOT NULL,
  `descricao` text NOT NULL,
  `albun_id` int(11) NOT NULL,
  `created` datetime NOT NULL,
  `modified` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;

&lt;/pre&gt;

&lt;p&gt;Preencha as linhas que comentei (host, login, password e database), com isso j√° temos o banco de dados tamb√©m conectado, para verificar, acesse a aplica√ß√£o no navegador e verifique a √∫ltima mensagem dos blocos coloridos.&lt;/p&gt;

&lt;p&gt;Para finalizar esta etapa de prepara√ß√£o, vamos criar os arquivos da galeria:&lt;/p&gt;

&lt;p&gt;Em app/Model crie Albun.php e Imagen.php (e sim, com n, j√° que o CakePHP trabalha com singular e plural em ingl√™s, at√© da pra mudar isso, mas o artigo j√° vai ficar enorme).&lt;/p&gt;

&lt;p&gt;Em app/Controller crie AlbunsController.php e ImagensController.php&lt;/p&gt;

&lt;p&gt;Em app/View crie 2 pastas (Albuns e Imagens) com 3 arquivos dentro de cada:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;admin_novo.ctp&lt;/li&gt;
&lt;li&gt;admin_editar.ctp&lt;/li&gt;
&lt;li&gt;admin_index.ctp&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;E apenas na¬†pasta Albuns, crie mais 2 arquivos al√©m dos dois que devem estar dentro dela e da Imagens:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ver.ctp&lt;/li&gt;
&lt;li&gt;index.ctp&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A partir deste ponto √© interessante que voc√™ conhe√ßa um pouco sobre MVC. Aqui vai uma dica: &lt;a href=&#34;http://blog.erikfigueiredo.com.br/exemplo-de-framework-com-psr-0-psr-1-e-psr-2-entendendo-o-padrao-mvc-na-pratica-parte-01/&#34;&gt;escrevi sobre isso aqui&lt;/a&gt;. N√£o precisa fazer o exemplo todo, apenas entender como √©.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Relacionando as imagens com os albuns&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Em primeiro lugar precisamos entender como as imagens se relacionam com cada √°lbum, a pr√≥pria documenta√ß√£o do CakePHP j√° fala sobre isso (&lt;a href=&#34;http://book.cakephp.org/2.0/en/models/associations-linking-models-together.html&#34;&gt;http://book.cakephp.org/2.0/en/models/associations-linking-models-together.html&lt;/a&gt;), infelizmente est√° em ingl√™s, vou eu mesmo mostrar como √©.&lt;/p&gt;

&lt;p&gt;Temos 4 tipos poss√≠veis de relacionamento entre tabelas.&lt;/p&gt;

&lt;p&gt;Um para um &amp;#8211; hasOne&lt;/p&gt;

&lt;p&gt;Um para muitos &amp;#8211; hasMany&lt;/p&gt;

&lt;p&gt;Muitos para um &amp;#8211; belongTo&lt;/p&gt;

&lt;p&gt;Muitos para muitos ‚Äì hasAndBelongsToMany ou HABTM&lt;/p&gt;

&lt;p&gt;Se voc√™ ler com calma j√° vai ver que √© f√°cil de definir relacionamentos, no nosso caso imagens tem um √°lbum ou Muitos para Um, indo ao contr√°rio, √°lbum te muitas imagens ou Um para Muitos, logo:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Album hasMany Imagem&lt;/p&gt;

&lt;p&gt;Imagems belongsTo Album&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Entendeu a l√≥gica por traz de definir os relacionamentos? Ent√£o vamos informar isso nos models.&lt;/p&gt;

&lt;p&gt;Abra os arquivos Album.php e Imagem.php que est√£o em app/Model e vamos configurar:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 5:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;//Albun.php

class Albun extends AppModel
{
    public $hasMany = array(&#39;Imagen&#39;);
}

// Imagen .php

class Imagen extends AppModel
{
    public $belongsTo = array(&#39;Albun&#39;);
}
&lt;/pre&gt;

&lt;p&gt;Pronto, com isso sempre que buscarmos algo no banco de dados ele j√° vai incluir automaticamente os dados relacionados, ou seja, se eu listar o √°lbum, ele vai trazer todas as imagens deste determinado √°lbum e o contr√°rio tamb√©m vai acontecer (dizer a qual √°lbum a imagem pertence).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Criando os controllers&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Os controllers v√£o decidir o que ser√° feito na aplica√ß√£o, ou seja, exibir o que? Pegar que infroma√ß√£o no banco? Que hora o upload deve ser feito? √â muito simples, os dois arquivos devem ser salvos em app/Controller:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 6:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;//AlbunsController.php

class AlbunsController extends AppController
{
    
}

//ImagensController.php

class ImagensController extends AppController
{
    
}
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Configurando a cria√ß√£o de √°lbuns de imagens na administra√ß√£o&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;No controller √°lbuns (AlbunsController.php) crie uma fun√ß√£o chamada admin_novo, assim:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 7:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;public function  admin_novo()
{
        if ($this-&amp;gt;request-&amp;gt;is(&#39;post&#39;)) {
            $this-&amp;gt;Albun-&amp;gt;create();
            if ($this-&amp;gt;Albun-&amp;gt;save($this-&amp;gt;request-&amp;gt;data)) {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;Album criado.&#39;));
                return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
            } else {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;Erro ao criar o √°lbum, tente novamente.&#39;));
            }
        }
}
&lt;/pre&gt;

&lt;p&gt;Este action (o nome dado as &lt;em&gt;functions&lt;/em&gt; de cada p√°gina nos controllers do CakePHP) vai testar se o carregamento da p√°gina foi um post, se sim, ele informa que estamos criando um registro, tenta salvar o registro e envia para a index caso tenha sucesso, com uma mensagem de ‚ÄúAlbum criado‚Äù, caso contr√°rio, apenas informa que algo deu errado.&lt;/p&gt;

&lt;p&gt;A view desta action, ou o cara que vai exibir os dados na tela do usu√°rio fica assim (arquivo app/View/Albuns/admin_novo.ctp):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 7A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;&amp;lt;div class=&#34;albuns form&#34;&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;create(&#39;Albun&#39;); ?&amp;gt;
 &amp;lt;fieldset&amp;gt;
 &amp;lt;legend&amp;gt;Novo album&amp;lt;/legend&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;titulo&#39;);
 ?&amp;gt;
 &amp;lt;/fieldset&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;end(__(&#39;Submit&#39;)); ?&amp;gt;
&amp;lt;/div&amp;gt;

&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Configurando a edi√ß√£o de √°lbuns de imagens na administra√ß√£o&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Muito parecido com add, mas dessa vez checando se o √°lbum especificado existe antes de salvar.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 8:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;public function admin_editar($id = null) {
        if (!$this-&amp;gt;Albun-&amp;gt;exists($id)) {
            throw new NotFoundException(__(&#39;Albun inv√°lido&#39;));
        }
        if ($this-&amp;gt;request-&amp;gt;is(array(&#39;post&#39;, &#39;put&#39;))) {
            if ($this-&amp;gt;Albun-&amp;gt;save($this-&amp;gt;request-&amp;gt;data)) {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;O √°lbum foi salvo.&#39;));
                return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
            } else {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;Erro ao criar o √°lbum, tente novamente.&#39;));
            }
        } else {
            $options = array(&#39;conditions&#39; =&amp;gt; array(&#39;Albun.&#39; . $this-&amp;gt;Albun-&amp;gt;primaryKey =&amp;gt; $id));
            $this-&amp;gt;request-&amp;gt;data = $this-&amp;gt;Albun-&amp;gt;find(&#39;first&#39;, $options);
        }
}
&lt;/pre&gt;

&lt;p&gt;E a view (app/View/Albuns/admin_editar.ctp)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 8A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;&amp;lt;div class=&#34;albuns form&#34;&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;create(&#39;Albun&#39;); ?&amp;gt;
 &amp;lt;fieldset&amp;gt;
 &amp;lt;legend&amp;gt;Editando album&amp;lt;/legend&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;id&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;titulo&#39;);
 ?&amp;gt;
 &amp;lt;/fieldset&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;end(__(&#39;Submit&#39;)); ?&amp;gt;
&amp;lt;/div&amp;gt;

&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Configurando a remo√ß√£o de √°lbuns de imagens na administra√ß√£o&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Tamb√©m preciso remover o √°lbum quando n√£o precisar mais dele. Temos uma action que pode cuidar disso, √© bem parecido com a admin_editar, mas desta vez ele usa &lt;strong&gt;delete&lt;/strong&gt; em vez de &lt;strong&gt;save&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 9:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public function admin_remover($id = null) {
        $this-&amp;gt;Albun-&amp;gt;id = $id;
        if (!$this-&amp;gt;Albun-&amp;gt;exists()) {
            throw new NotFoundException(__(&#39;Invalid albun&#39;));
        }
        $this-&amp;gt;request-&amp;gt;onlyAllow(&#39;post&#39;, &#39;delete&#39;);
        if ($this-&amp;gt;Albun-&amp;gt;delete()) {
            $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The albun has been deleted.&#39;));
        } else {
            $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The albun could not be deleted. Please, try again.&#39;));
        }
        return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
}
&lt;/pre&gt;

&lt;p&gt;Este &lt;strong&gt;action&lt;/strong&gt; redireciona para index, ent√£o ele n√£o tem uma view.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Configurando a listagem de √°lbuns de imagens na administra√ß√£o&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;E pra fechar a administra√ß√£o de √°lbuns, a listagem de √°lbuns com pagina√ß√£o:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 10:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public function admin_index() {
    $this-&amp;gt;Albun-&amp;gt;recursive = -1;
    $this-&amp;gt;set(&#39;albuns&#39;, $this-&amp;gt;Paginator-&amp;gt;paginate());
}
&lt;/pre&gt;

&lt;p&gt;O &lt;strong&gt;recursive -1&lt;/strong&gt; impede que o √°lbum traga os dados relacionados que no nosso caso s√£o as imagens, a segunda linha traz os √°lbuns salvos no banco com pagina√ß√£o (p√°gina 1, p√°gina 2&amp;#8230;).&lt;/p&gt;

&lt;p&gt;N√£o esque√ßa de ativar o componente paginator no seu controller acrescentando a vari√°vel $components no inicio da classe AlbunsController (logo abaixo tem um exemplo na classe imagens)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 11:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public $components = array(&#39;Paginator&#39;);
&lt;/pre&gt;

&lt;p&gt;E a view (app/View/Albuns/admin_index.ctp):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 10A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;&amp;lt;div class=&#34;albuns index&#34;&amp;gt; &amp;lt;h2&amp;gt;Albuns&amp;lt;/h2&amp;gt;
 &amp;lt;table cellpadding=&#34;0&#34; cellspacing=&#34;0&#34;&amp;gt;
 &amp;lt;tr&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;id&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;titulo&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;created&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;modified&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th class=&#34;actions&#34;&amp;gt;&amp;lt;?php echo __(&#39;Actions&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;?php foreach ($albuns as $albun): ?&amp;gt;
 &amp;lt;tr&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($albun[&#39;Albun&#39;][&#39;id&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($albun[&#39;Albun&#39;][&#39;titulo&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($albun[&#39;Albun&#39;][&#39;created&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($albun[&#39;Albun&#39;][&#39;modified&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td class=&#34;actions&#34;&amp;gt;
 &amp;lt;?php echo $this-&amp;gt;Html-&amp;gt;link(&#39;Editar&#39;, array(&#39;action&#39; =&amp;gt; &#39;editar&#39;, $albun[&#39;Albun&#39;][&#39;id&#39;])); ?&amp;gt;
 &amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;postLink(&#39;Remover&#39;, array(&#39;action&#39; =&amp;gt; &#39;remover&#39;, $albun[&#39;Albun&#39;][&#39;id&#39;]), null, __(&#39;Tem certeza que quer remover # %s?&#39;, $albun[&#39;Albun&#39;][&#39;titulo&#39;])); ?&amp;gt;
 &amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
&amp;lt;?php endforeach; ?&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;p&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Paginator-&amp;gt;counter(array(
 &#39;format&#39; =&amp;gt; __(&#39;Page {:page} of {:pages}, showing {:current} records out of {:count} total, starting on record {:start}, ending on {:end}&#39;)
 ));
 ?&amp;gt; &amp;lt;/p&amp;gt;
 &amp;lt;div class=&#34;paging&#34;&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Paginator-&amp;gt;prev(&#39;&amp;lt; &#39; . __(&#39;previous&#39;), array(), null, array(&#39;class&#39; =&amp;gt; &#39;prev disabled&#39;));
 echo $this-&amp;gt;Paginator-&amp;gt;numbers(array(&#39;separator&#39; =&amp;gt; &#39;&#39;));
 echo $this-&amp;gt;Paginator-&amp;gt;next(__(&#39;next&#39;) . &#39; &amp;gt;&#39;, array(), null, array(&#39;class&#39; =&amp;gt; &#39;next disabled&#39;));
 ?&amp;gt;
 &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class=&#34;actions&#34;&amp;gt;
 &amp;lt;h3&amp;gt;Actions&amp;lt;/h3&amp;gt;
 &amp;lt;ul&amp;gt;
 &amp;lt;li&amp;gt;&amp;lt;?php echo $this-&amp;gt;Html-&amp;gt;link(__(&#39;Novo&#39;), array(&#39;action&#39; =&amp;gt; &#39;novo&#39;)); ?&amp;gt;&amp;lt;/li&amp;gt;
 &amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;

&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Configurando a administra√ß√£o de imagens&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A administra√ß√£o de imagens √© bem parecida com a de √°lbuns, vou apenas passar o c√≥digo pra gente n√£o se estender muito, mas est√° bem simples de entender.&lt;/p&gt;

&lt;p&gt;Primeiro o controller ImagensController.php&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 12:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;public $components = array(&#39;Paginator&#39;);

    public function admin_index() {
        $this-&amp;gt;Imagen-&amp;gt;recursive = 0;
        $this-&amp;gt;set(&#39;imagens&#39;, $this-&amp;gt;Paginator-&amp;gt;paginate());
    }

    public function admin_novo() {
        if ($this-&amp;gt;request-&amp;gt;is(&#39;post&#39;)) {
            $this-&amp;gt;Imagen-&amp;gt;create();
            $this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;] = $this-&amp;gt;Imagen-&amp;gt;upload($this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;], $this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;albun_id&#39;]);
            if ($this-&amp;gt;Imagen-&amp;gt;save($this-&amp;gt;request-&amp;gt;data)) {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen has been saved.&#39;));
                return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
            } else {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen could not be saved. Please, try again.&#39;));
            }
        }
        $albuns = $this-&amp;gt;Imagen-&amp;gt;Albun-&amp;gt;find(&#39;list&#39;, array(&#39;fields&#39;=&amp;gt;array(&#39;id&#39;,&#39;titulo&#39;)));
        $this-&amp;gt;set(compact(&#39;albuns&#39;));
    }

    public function admin_editar($id = null) {
        if (!$this-&amp;gt;Imagen-&amp;gt;exists($id)) {
            throw new NotFoundException(__(&#39;Invalid imagen&#39;));
        }
        if ($this-&amp;gt;request-&amp;gt;is(array(&#39;post&#39;, &#39;put&#39;))) {
            $this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;] = $this-&amp;gt;Imagen-&amp;gt;upload($this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;], $this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;albun_id&#39;]);
            if ($this-&amp;gt;Imagen-&amp;gt;save($this-&amp;gt;request-&amp;gt;data)) {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen has been saved.&#39;));
                return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
            } else {
                $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen could not be saved. Please, try again.&#39;));
            }
        } else {
            $options = array(&#39;conditions&#39; =&amp;gt; array(&#39;Imagen.&#39; . $this-&amp;gt;Imagen-&amp;gt;primaryKey =&amp;gt; $id));
            $this-&amp;gt;request-&amp;gt;data = $this-&amp;gt;Imagen-&amp;gt;find(&#39;first&#39;, $options);
        }
        $albums = $this-&amp;gt;Imagen-&amp;gt;Albun-&amp;gt;find(&#39;list&#39;, array(&#39;fields&#39;=&amp;gt;array(&#39;id&#39;,&#39;titulo&#39;)));
        $this-&amp;gt;set(compact(&#39;albums&#39;));
    }

    public function admin_remover($id = null) {
        $this-&amp;gt;Imagen-&amp;gt;id = $id;
        if (!$this-&amp;gt;Imagen-&amp;gt;exists()) {
            throw new NotFoundException(__(&#39;Invalid imagen&#39;));
        }
        $this-&amp;gt;request-&amp;gt;onlyAllow(&#39;post&#39;, &#39;delete&#39;);
        if ($this-&amp;gt;Imagen-&amp;gt;delete()) {
            $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen has been deleted.&#39;));
        } else {
            $this-&amp;gt;Session-&amp;gt;setFlash(__(&#39;The imagen could not be deleted. Please, try again.&#39;));
        }
        return $this-&amp;gt;redirect(array(&#39;action&#39; =&amp;gt; &#39;index&#39;));
    }
&lt;/pre&gt;

&lt;p&gt;E as views:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 12A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;//app/View/Imagens/admin_index.ctp
&amp;lt;div class=&#34;imagens index&#34;&amp;gt;
 &amp;lt;h2&amp;gt;Imagens&amp;lt;/h2&amp;gt;
 &amp;lt;table cellpadding=&#34;0&#34; cellspacing=&#34;0&#34;&amp;gt;
 &amp;lt;tr&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;id&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;imagem&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;titulo&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;descricao&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;albun_id&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;created&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th&amp;gt;&amp;lt;?php echo $this-&amp;gt;Paginator-&amp;gt;sort(&#39;modified&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;th class=&#34;actions&#34;&amp;gt;&amp;lt;?php echo __(&#39;Actions&#39;); ?&amp;gt;&amp;lt;/th&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;?php foreach ($imagens as $imagen): ?&amp;gt;
 &amp;lt;tr&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;id&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;url&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;titulo&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;descricao&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;albun_id&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;created&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td&amp;gt;&amp;lt;?php echo h($imagen[&#39;Imagen&#39;][&#39;modified&#39;]); ?&amp;gt;&amp;nbsp;&amp;lt;/td&amp;gt;
 &amp;lt;td class=&#34;actions&#34;&amp;gt;
 &amp;lt;?php echo $this-&amp;gt;Html-&amp;gt;link(&#39;Editar&#39;, array(&#39;action&#39; =&amp;gt; &#39;editar&#39;, $imagen[&#39;Imagen&#39;][&#39;id&#39;])); ?&amp;gt;
 &amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;postLink(&#39;Delete&#39;, array(&#39;action&#39; =&amp;gt; &#39;remover&#39;, $imagen[&#39;Imagen&#39;][&#39;id&#39;]), null, __(&#39;Tem certeza que quer remover # %s?&#39;, $imagen[&#39;Imagen&#39;][&#39;titulo&#39;])); ?&amp;gt;
 &amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
&amp;lt;?php endforeach; ?&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;p&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Paginator-&amp;gt;counter(array(
 &#39;format&#39; =&amp;gt; __(&#39;Page {:page} of {:pages}, showing {:current} records out of {:count} total, starting on record {:start}, ending on {:end}&#39;)
 ));
 ?&amp;gt; &amp;lt;/p&amp;gt;
 &amp;lt;div class=&#34;paging&#34;&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Paginator-&amp;gt;prev(&#39;&amp;lt; &#39; . __(&#39;previous&#39;), array(), null, array(&#39;class&#39; =&amp;gt; &#39;prev disabled&#39;));
 echo $this-&amp;gt;Paginator-&amp;gt;numbers(array(&#39;separator&#39; =&amp;gt; &#39;&#39;));
 echo $this-&amp;gt;Paginator-&amp;gt;next(__(&#39;next&#39;) . &#39; &amp;gt;&#39;, array(), null, array(&#39;class&#39; =&amp;gt; &#39;next disabled&#39;));
 ?&amp;gt;
 &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class=&#34;actions&#34;&amp;gt;
 &amp;lt;h3&amp;gt;Actions&amp;lt;/h3&amp;gt;
 &amp;lt;ul&amp;gt;
 &amp;lt;li&amp;gt;&amp;lt;?php echo $this-&amp;gt;Html-&amp;gt;link(__(&#39;Novo&#39;), array(&#39;action&#39; =&amp;gt; &#39;novo&#39;)); ?&amp;gt;&amp;lt;/li&amp;gt;
 &amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;

//app/View/Imagens/admin_novo.ctp
&amp;lt;div class=&#34;imagens form&#34;&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;create(&#39;Imagen&#39;,array(&#39;type&#39;=&amp;gt;&#39;file&#39;)); ?&amp;gt;
 &amp;lt;fieldset&amp;gt;
 &amp;lt;legend&amp;gt;Nova imagem&amp;lt;/legend&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;url&#39;,array(&#39;type&#39;=&amp;gt;&#39;file&#39;));
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;titulo&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;descricao&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;albun_id&#39;);
 ?&amp;gt;
 &amp;lt;/fieldset&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;end(__(&#39;Submit&#39;)); ?&amp;gt;
&amp;lt;/div&amp;gt;

//app/View/Imagens/admin_editar.ctp
&amp;lt;div class=&#34;imagens form&#34;&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;create(&#39;Imagen&#39;); ?&amp;gt;
 &amp;lt;fieldset&amp;gt;
 &amp;lt;legend&amp;gt;Editando imagem&amp;lt;/legend&amp;gt;
 &amp;lt;?php
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;id&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;url&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;titulo&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;descricao&#39;);
 echo $this-&amp;gt;Form-&amp;gt;input(&#39;albun_id&#39;);
 ?&amp;gt;
 &amp;lt;/fieldset&amp;gt;
&amp;lt;?php echo $this-&amp;gt;Form-&amp;gt;end(__(&#39;Submit&#39;)); ?&amp;gt;
&amp;lt;/div&amp;gt;

&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Configurando o upload e tratamento de imagens&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Note nas actions admin_novo e admin_editar do ImagensController que voc√™ tem uma linha assim:&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;$this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;] = $this-&amp;gt;Imagen-&amp;gt;upload($this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;url&#39;], $this-&amp;gt;request-&amp;gt;data[&#39;Imagen&#39;][&#39;albun_id&#39;]);
&lt;/pre&gt;

&lt;p&gt;Ela carrega uma fun√ß√£o do model Imagen.php chamada upload que cuida de salvar os dados do arquivo enviado ($this-&amp;gt;request-&amp;gt;data[&amp;#8216;Imagen&amp;#8217;][&amp;#8216;url&amp;#8217;]) e tamb√©m criar uma pasta com o id do √°lbum atual ($this-&amp;gt;request-&amp;gt;data[&amp;#8216;Imagen&amp;#8217;][&amp;#8216;albun_id&amp;#8217;]) no diret√≥rio app/webroot/img, mas o que ela faz ao certo?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Primeiro vamos verificar se o arquivo enviado tem o tipo certo (jpeg, gif, png&amp;#8230;)&lt;/li&gt;
&lt;li&gt;Em seguida verificamos se deu tudo certo durante o upload&lt;/li&gt;
&lt;li&gt;Caso tenha, checo se o diret√≥rio aonde as imagens v√£o fica existe (ser√° em app/webroot/img/album/{id do √°lbum}), se n√£o existir eu crio&lt;/li&gt;
&lt;li&gt;Ent√£o parto pra etapa de convers√£o de nome, transformando em um formato aceito na web, mas sem perder o nome de arquivo que o usu√°rio tinha antes&lt;/li&gt;
&lt;li&gt;E uso o WideImage pra ajustar a imagem para um tamanho aproximado de 800x600px e criar uma miniatura de 250x250px exatos (cortando o excesso a partir de centro da imagem)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;O c√≥digo completo vai no app/Model/Imagen.php, logo a baixo da linha da vari√°vel $belongsTo:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 13:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-php&#34;&gt;public function upload($arquivo, $id) {
        $ext = array(
            &#39;image/jpeg&#39;,
            &#39;image/pjpeg&#39;,
            &#39;image/x-jps&#39;,
            &#39;image/png&#39;,
            &#39;image/gif&#39;,
        );
        
        if ($arquivo[&#39;error&#39;]!=0 || $arquivo[&#39;size&#39;]==0 || !in_array($arquivo[&#39;type&#39;], $ext)){
            return false;
        }
        
        
        if(!is_dir(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id)){  
            App::uses(&#39;Folder&#39;, &#39;Utility&#39;); 
            
            $folder = new Folder();
            if($folder-&amp;gt;create(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id)){  
                //se conseguiu criar o diret√≥rio eu dou permiss√£o  
                $folder-&amp;gt;chmod(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id, 0755, true);  
            } else {  
                return false;  
            }
            $folder = new Folder();
            if($folder-&amp;gt;create(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id.DS.&#39;thumb&#39;)){  
                //se conseguiu criar o diret√≥rio eu dou permiss√£o  
                $folder-&amp;gt;chmod(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id.DS.&#39;thumb&#39;, 0755, true);  
            } else {  
                return false;  
            }
        }
        
        $pathinfo=pathinfo($arquivo[&#39;name&#39;]);
        $pathinfo[&#39;filename&#39;]=strtolower(Inflector::slug($pathinfo[&#39;filename&#39;],&#39;-&#39;));
        $arquivo[&#39;name&#39;]=$pathinfo[&#39;filename&#39;].&#39;.&#39;.$pathinfo[&#39;extension&#39;];
        
        App::import(&#39;Vendor&#39;, &#39;wideimage/WideImage&#39;);  
        $img = WideImage::load($arquivo[&#39;tmp_name&#39;]);  
        $img = $img-&amp;gt;resize(800,600,&#39;outside&#39;);  
        $min = $img-&amp;gt;resize(250,250,&#39;outside&#39;);  
        $min = $min-&amp;gt;crop(&#39;50%-125&#39;,&#39;50%-125&#39;,250,250);
        $img-&amp;gt;saveToFile(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id.DS.$arquivo[&#39;name&#39;]);
        $min-&amp;gt;saveToFile(WWW_ROOT.&#39;img&#39;.DS.&#39;album&#39;.DS.$id.DS.&#39;thumb&#39;.DS.$arquivo[&#39;name&#39;]);
        
        return $arquivo[&#39;name&#39;];
    }
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Listando os √°lbuns&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Bem, nossa aplica√ß√£o j√° est√° salvando a imagem, j√° cria √°lbuns e associa um ao outro, mas ainda n√£o mostra o resultado final, vamos configurar isso.&lt;/p&gt;

&lt;p&gt;Primeiro precisamos de uma listagem de √°lbuns com uma miniatura e um titulo para o usu√°rio escolher o que quer ver.&lt;/p&gt;

&lt;p&gt;Vou configurar para que a miniatura seja a primeira imagem do √°lbum, vamos ao controller (app/Controller/AlbunsController.php):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 14:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public function index() {
        $albuns = $this-&amp;gt;Albun-&amp;gt;find(
            &#39;all&#39;,
            array(
                &#39;contain&#39;=&amp;gt;array(
                    &#39;Imagen&#39;=&amp;gt;array(
                        &#39;limit&#39;=&amp;gt;1
                    )
                )
            )
        );
        $this-&amp;gt;set(&#39;albuns&#39;, $albuns);
    }
&lt;/pre&gt;

&lt;p&gt;Voc√™ viu que eu usei o contain ali dentro do array, isso √© um behavior e ele precisa ser chamado no Model pra funcionar, para isso v√° ao model Albun.php e acrescente a vari√°vel antes ou depois da var $hasMany:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 14A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public $actsAs = array(&#39;Containable&#39;);&lt;/pre&gt;

&lt;p&gt;A view √© a &lt;em&gt;app/Albuns/index.ctp&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 14B:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;&amp;lt;?php

foreach ($albuns as $v) :
 if(!empty($v[&#39;Imagen&#39;][0][&#39;url&#39;])) {
 echo &#39;&amp;lt;div style=&#34;float:left&#34;&amp;gt;&#39;;
 $img = $this-&amp;gt;Html-&amp;gt;image(&#39;album/&#39;.$v[&#39;Albun&#39;][&#39;id&#39;].&#39;/40/&#39;.$v[&#39;Imagen&#39;][0][&#39;url&#39;]);
 echo $this-&amp;gt;Html-&amp;gt;link($img,&#39;/albuns/ver/&#39;.$v[&#39;Albun&#39;][&#39;id&#39;],array(&#39;escape&#39;=&amp;gt;false)).&#39;&amp;lt;br&amp;gt;&#39;;
 echo $v[&#39;Albun&#39;][&#39;titulo&#39;];
 echo &#39;&amp;lt;/div&amp;gt;&#39;;
 }
endforeach;
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Listando as imagens de cada √°lbum&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;E pra fechar nossa galeria faltou apenas criarmos a exibi√ß√£o da galeria em si, para isso devemos trazer o nosso √°lbum e o CakePHP j√° vai trazer os dados relacionados a ele (que no nosso caso s√£o as imagens):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 15:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;public function ver($id = null) {
        if (!$this-&amp;gt;Albun-&amp;gt;exists($id)) {
            throw new NotFoundException(__(&#39;Invalid albun&#39;));
        }
        
        $options = array(&#39;conditions&#39; =&amp;gt; array(&#39;Albun.&#39; . $this-&amp;gt;Albun-&amp;gt;primaryKey =&amp;gt; $id));
        $album = $this-&amp;gt;Albun-&amp;gt;find(&#39;first&#39;, $options);
        $this-&amp;gt;set(&#39;album&#39;, $album);
    }
&lt;/pre&gt;

&lt;p&gt;A view ver.ctp(n√£o vou falar o caminho desta vez, deve ter ficado claro pra voc√™) de √°lbuns vai exibir o html j√° formatado para eu usar o Fancybox, ou seja, imagem dentro de um link.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 15A:&lt;/strong&gt;&lt;/p&gt;

&lt;pre class=&#34;lang-html&#34;&gt;&amp;lt;h3&amp;gt;&amp;lt;?php echo $album[&#39;Albun&#39;][&#39;titulo&#39;];?&amp;gt;&amp;lt;/h3&amp;gt;
&amp;lt;?php foreach ($album[&#39;Imagen&#39;] as $v) :
 $img = $this-&amp;gt;Html-&amp;gt;image(&#39;album/&#39;.$album[&#39;Albun&#39;][&#39;id&#39;].&#39;/40/&#39;.$v[&#39;url&#39;]);
 echo $this-&amp;gt;Html-&amp;gt;link(
 $img,
 &#39;/img/album/&#39;.$album[&#39;Albun&#39;][&#39;id&#39;].&#39;/&#39;.$v[&#39;url&#39;],
 array(
 &#39;escape&#39;=&amp;gt;false,
 &#39;class&#39;=&amp;gt;&#39;fancy&#39;,
 &#39;alt&#39;=&amp;gt;$v[&#39;descricao&#39;],
 &#39;title&#39;=&amp;gt;$v[&#39;titulo&#39;],
 &#39;rel&#39;=&amp;gt;$album[&#39;Albun&#39;][&#39;titulo&#39;]
 )
 );
endforeach;?&amp;gt;
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Integrando ao FancyBox&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O Fancybox √© um plugin para frontend, ent√£o o processo √© o mesmo que em qualquer outro lugar, basta criar o HTML da galeria no formato que ele usa (fizemos isso no passo anterior) e chamar os javascripts, css e configurar o plugin.&lt;/p&gt;

&lt;p&gt;Ainda na view ver.ctp de Albuns, fa√ßa isso logo no final:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cod. 16:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;Html-&amp;gt;script(
        array(
            &#39;//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js&#39;,
            &#39;/fancy/jquery.fancybox.pack&#39;
        ),
        array(&#39;inline&#39;=&amp;gt;false)
    );
    echo $this-&amp;gt;Html-&amp;gt;css(
        array(&#39;/fancy/jquery.fancybox&#39;),
        null,
        array(&#39;inline&#39;=&amp;gt;false)
    );
    echo $this-&amp;gt;Html-&amp;gt;scriptBlock(
        &#39;$(&#34;.fancy&#34;).fancybox();&#39;,
        array(&#39;inline&#39;=&amp;gt;false)
    );
?&amp;gt;
&lt;/pre&gt;

&lt;p&gt;O primeiro bloco (Html-&amp;gt;script) chama os javascripts (o jquery do server do Google e o jquery.fancybox.pack.js que est√° no diret√≥rio webroot).&lt;/p&gt;

&lt;p&gt;O segundo bloco (Html-&amp;gt;css) faz o mesmo com o css local.&lt;/p&gt;

&lt;p&gt;E o terceiro cria um bloco &amp;#8230; configurando o Fancybox, note que eu coloquei tudo com inline=&amp;gt;false assim ele n√£o imprime isso na view e sim nas tags script e css que est√£o no nosso arquivo app/View/Layout/default.ctp (j√° vem no CakePHP) pra evitar a bagun√ßa (como se o javacript direto na p√°gina fosse muito organizado, mas deu pra entender bem como proceder).&lt;/p&gt;

&lt;h3 id=&#34;como-usar&#34;&gt;Como usar?&lt;/h3&gt;

&lt;p&gt;F√°cil, voc√™ tem tr√™s urls base:&lt;/p&gt;

&lt;p&gt;/albuns ‚Äì listagem de √°lbuns&lt;/p&gt;

&lt;p&gt;/admin/abuns ‚Äì administra√ß√£o de √°lbuns&lt;/p&gt;

&lt;p&gt;/admin/imagens ‚Äì administra√ß√£o de imagens&lt;/p&gt;

&lt;p&gt;Al√©m disso voc√™ ainda pode usar estas urls, mas a navega√ß√£o da galeria j√° vai te guia por elas:&lt;/p&gt;

&lt;p&gt;/admin/novo&lt;/p&gt;

&lt;p&gt;/admin/albuns/editar/{id do album}&lt;/p&gt;

&lt;p&gt;/admin/albuns/remover/{id do √°lbum}&lt;/p&gt;

&lt;p&gt;/admin/novo&lt;/p&gt;

&lt;p&gt;/admin/imagens/editar/{id da imagem}&lt;/p&gt;

&lt;p&gt;/admin/imagens/remover/{id da imagem}&lt;/p&gt;

&lt;p&gt;/albuns/ver/{id do album}&lt;/p&gt;

&lt;p&gt;Perceba que cada action gerou uma url e que o admin_ gerou um /admin em cada action, al√©m dos ids e os controllers, no fim voc√™ entende que as urls seguem o padr√£o&lt;/p&gt;

&lt;p&gt;/:prefixo/:controller/:action ‚Äì lembrando que o prefixo √© o admin&lt;/p&gt;

&lt;p&gt;Ou&lt;/p&gt;

&lt;p&gt;/:controller/:action&lt;/p&gt;

&lt;p&gt;Ou&lt;/p&gt;

&lt;p&gt;/:controller ‚Äì e action passada √© a index por padr√£o quando uma n√£o for especificada.&lt;/p&gt;

&lt;p&gt;Isso ainda pode ser personalizado, mas √© outro assunto.&lt;/p&gt;

&lt;h3 id=&#34;conclus√£o-western&#34;&gt;Conclus√£o {.western}&lt;/h3&gt;

&lt;p&gt;Note que esta √© uma tarefa normalmente dispendiosa, √© uma administra√ß√£o completa de galeria de imagens que embora simples √© bem completa e eu consegui resumir tudo em poucas linhas de c√≥digo e um artigo apenas.&lt;/p&gt;

&lt;p&gt;Voc√™ ainda precisa proteger a administra√ß√£o da sua aplica√ß√£o com senha, adicionar um controle de imagens melhor, checar se o arquivo existe e alterar o nome para n√£o substituir, apagar a imagem quando o dado for apagado do banco (tanto o √°lbum quanto as imagens), remover a imagem antiga quando troca no admin_editar, setar imagem de capa do √°lbum&amp;#8230; enfim, mas agora voc√™ tem um norte pra come√ßar a trabalhar.&lt;/p&gt;

&lt;p&gt;Aqui o arquivo pronto para download (o sql do banco est√° em app/Config/Schema/database.sql): &lt;a href=&#34;http://blog.erikfigueiredo.com.br/galeria.zip&#34;&gt;http://blog.erikfigueiredo.com.br/galeria.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Obrigado a todos.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>