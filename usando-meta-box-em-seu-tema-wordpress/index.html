
<!DOCTYPE html>
<html lang="pt-br" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <base href="https://tableless.github.io/hugo-public/">
  <title>Tableless</title>
  <link rel="canonical" href="https://tableless.github.io/hugo-public/usando-meta-box-em-seu-tema-wordpress/">
  <link href="" rel="alternate" type="application/rss+xml" title="Tableless" />
  <link rel="stylesheet" href="https://tableless.github.io/hugo-public/css/style.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css">

</head>
<body>


  <header id="tb-header">
    <a href="https://tableless.github.io/hugo-public/" class="tb-logo"><img src="images/logo.svg"></a>

    

    <nav id="tb-menu">
      <ul>

        
          
              
            <li>
              <a href="/hugo-public/categories/html">
                  
                  HTML
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/css/">
                  
                  CSS
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/javascript/">
                  
                  JavaScript
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/back-end/">
                  
                  Back-end
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/wordpress/">
                  
                  WordPress
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/acessibilidade/">
                  
                  Acessibilidade
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/design/">
                  
                  Design
              </a>
          
            </li>
          
              
            <li>
              <a href="/hugo-public/categories/t%C3%A9cnicas-e-pr%C3%A1ticas/">
                  
                  Na pr√°tica
              </a>
          
            </li>
          

      </ul>
    </nav>

  </header>

  <header class="tb-post-header">
    <h1 class="tb-hero-title"><a href="/hugo-public/usando-meta-box-em-seu-tema-wordpress/">Usando Meta Box em seu tema WordPress</a></h1>
  <p class="tb-hero-p">
    
    Entenda como funcionam o Meta Box do Wordpress.
    
  </p>
      <span class="tb-author">por <a href="/hugo-public/author/giovanni-keppelen">Giovanni Keppelen</a></span>


  </header>


<section class="tb-post">

  <section class="tb-post-content">
    <article class="tb-post-article">
      

<h2 id="o-que-s√£o-meta-boxes">O que s√£o Meta Boxes?</h2>

<p>Os Meta Boxes (Caixas de informa√ß√µes) foi implementado a partir da vers√£o 2.5 do CMS, os Meta Boxes s√£o aquelas caixas arrast√°veis que est√£o presente na Dashboard, edi√ß√£o de um post, p√°ginas, al√©m de outros locais na √°rea administrativa do WordPress.</p>

<p>Os Meta Boxes √© uma maneira atraente para a tela do editor de post e evita for√ßar os usu√°rios a confiar em <a title="Custom Post Type" href="http://tableless.com.br/custom-post-types-wordpress/" target="_blank">campos personalizados</a>. Se voc√™ j√° criou algum tipo de campo personalizado no WordPress, voc√™ provavelmente gostaria de adicionar algum campo.</p>

<p>Com os Meta Box e mais f√°cil. Imagine que voc√™ esteja criando um tema para um cliente que precise catalogar sua cole√ß√£o de vinil. Voc√™ come√ßa imediatamente olhar para o WordPress para ver como isso pode ser feito. Cada Post representa um Vinil, que √© perfeito para adicionar imagem, titulo e descri√ß√£o. Podemos usar tamb√©m as categorias e marcar dentro do WordPress para que os organize. Mas vamos supor que o cara queira acrescentar mais um dado para cataloga√ß√£o? O WordPress n√£o te dar essa op√ß√£o por padr√£o a n√£o ser que usemos o grande Meta Box.</p>

<h2 id="usando-o-meta-boxes">Usando o Meta boxes</h2>

<p>Neste tutorial n√£o iremos trabalhar em um arquivo functions.php. Que n√£o √© o lugar correto para ele. Se voc√™ est√° adicionando dados a uma mensagem, √© prov√°vel que voc√™ quer que ele exista independentemente do seu projeto de front end. Como tal, voc√™ deve colocar esse c√≥digo em algum lugar que n√£o √© dependente do seu design. Ex: Um arquivo de plugin.</p>

<p>Convenientemente o WordPress oferece uma fun√ß√£o para adicionar os Meta Boxes a uma tela de administra√ß√£o, usando o seguinte &#8220;add_meta_box&#8221;. Abaixo um exemplo.</p>

<pre class="lang-php">&lt;?php add_meta_box( $id, $title, $callback, $page, $context, $priority, $callback_args ); ?&gt;

</pre>

<h3 id="par√¢metros">Par√¢metros</h3>

<ul>
<li>$id &#8211; (<a title="String" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#String" target="_blank">String</a>) Identificador √∫nico (Obrigat√≥rio)</li>
<li>$title &#8211; (<a title="String" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#String" target="_blank">String</a>) Titulo a ser exibido (Obrigat√≥rio)</li>
<li>$callback &#8211; (<a title="Callback" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#Callback" target="_blank">Callback</a>) Fun√ß√£o para exibir o conte√∫do do Meta Boxes (Obrigat√≥rio) <a title="Exemplo Callback" href="http://codex.wordpress.org/Function_Reference/add_meta_box#Example" target="_blank">Exemplo</a></li>
<li>$page &#8211; (<a title="String" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#String" target="_blank">String</a>) Onde ser√° exibido o Meta Boxes. Exemplos (<tt>&lsquo;post&rsquo;</tt>, <tt>&lsquo;page&rsquo;</tt>, <tt>&lsquo;link&rsquo;</tt>, or<tt>&lsquo;custom_post_type&rsquo; )</tt></li>
<li>$context (<a title="String" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#String" target="_blank">String</a>) Tela onde o box vai ser inserido.</li>
<li>$priority (<a title="String" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#String" target="_blank">String</a>) Prioridade de inser√ß√£o da caixa em rela√ß√£o as demais.</li>
<li>$callback_args (<a title="Array" href="http://codex.wordpress.org/How_to_Pass_Tag_Parameters#Array" target="_blank">array</a>) Determina a passagem de par√¢metros a fun√ß√£o callback.</li>
</ul>

<p>Ent√£o, nosso <strong>add_meta_box</strong> ser√° parecido com esse.</p>

<pre class="lang-php">&lt;?php add_meta_box ( 'my-meta-box-id', 'Meu primeiro Meta Box', 'vinil_meta_box_vinil', 'post', 'normal', 'high' ); ?&gt;

</pre>

<p>N√£o podemos simplesmente colocar em nosso arquivo plugin sozinho, se n√£o vamos acabar na tela branca da morte ou o erro fatal PHP. Chamada para a fun√ß√£o indefinida, por qu√™? Porque chamamos a fun√ß√£o add_meta_box antes do WordPress ser carregado. Com isso precisamos fazer um gancho no WordPress, que faz parte da api de um plugin. Basicamente, as fun√ß√µes come√ßam enganchando em uma a√ß√£o do WordPress. Ent√£o vamos fazer nosso gancho add_meta_box em uma fun√ß√£o, ent√£o conectar essa fun√ß√£o ao add_meta_boxes, evitando o erro fatal. Nosso c√≥digo para o Meta Boxes para tela de postagem ficar√° assim:</p>

<pre class="lang-php">&lt;?php add_action( 'add_meta_boxes', 'vinil_meta_box_add' );

function vinil_meta_box_add() {

add_meta_box( 'my-meta-box-id', 'Meu primeiro Meta Box', 'vinil_meta_box_vinil', 'post', 'normal', 'high' ); }

?&gt;

</pre>

<h2 id="renderizando-o-meta-box">Renderizando o Meta Box</h2>

<p>O c√≥digo acima √© o suficiente para adicionar o Meta Box, mas agora temos que tornar a coisa mais legal. Vamos adicionar campos, apenas um formul√°rio HTML misturado com um pouco de PHP para exibir os dados salvos. N√£o precisamos incluir as tags de formul√°rio pois o WordPress j√° faz isso para a gente. üôÇ Lembre que a string passada como o $callback em add_meta_box? Agora vamos criar um fun√ß√£o com o mesmo nome.</p>

<pre class="lang-php">&lt;?php function vinil_meta_box_vinil() {

echo 'Conte√∫do do meu primeiro Meta Box.'; }

?&gt;

</pre>

<p>Agora vamos fazer o formul√°rio, vamos adicionar v√°rios campos para este Meta Box, 1 input, 1 select, 1 checkbox. Vamos come√ßar com o input.</p>

<p>Na fun√ß√£o</p>

<pre class="lang-php">function vinil_meta_box_vinil() {

echo 'Conte√∫do do meu primeiro Meta Box.'; }

?&gt;

</pre>

<p>Vamos retirar o</p>

<pre class="lang-php">echo 'Conte√∫do do meu primeiro Meta Box';

</pre>

<p>Para come√ßar a fazer o formulario do Meta Box, ficando da seguinte forma:</p>

<pre class="lang-php">function vinil_meta_box_vinil()
{
?&gt;
&lt;p&gt;
&lt;label for="texto_meta_box"&gt;Text Label&lt;/label&gt;
&lt;input type="text" name="texto_meta_box" id="texto_meta_box" /&gt;
&lt;/p&gt;
&lt;?php
}

?&gt;

</pre>

<p>Mas e quanto a exibir os dados? Bem voc√™ ver√° a seguinte, vamos armazenar esses dados na tabela usando a fun√ß√£o wp_postmeta update_post_meta. Essas fun√ß√µes tem duas irm√£s chamada get_post_meta e get_post_custom, que pega os dados de wp_postmeta. O get_post_meta s√≥ peega dados de uma chave, enquanto get_post_custom pega tudo. Como estamos usando realmente apenas um campo, neste ponto, vamos usar o get_post_meta.</p>

<pre class="lang-php">function vinil_meta_box_vinil()
{
$values = get_post_custom( $post-&gt;ID );
$text = isset( $values['texto_meta_box'] ) ? esc_attr( $values['texto_meta_box'][0] ) : '';
$selected = isset( $values['meta_box_select'] ) ? esc_attr( $values['meta_box_select'][0] ) : '';
$check = isset( $values['meta_box_check'] ) ? esc_attr( $values['meta_box_check'][0] ) : '';
wp_nonce_field( 'my_meta_box_nonce', 'meta_box_nonce' );
?&gt;
&lt;p&gt;
&lt;label for="texto_meta_box"&gt;Text Label&lt;/label&gt;
&lt;input type="text" name="texto_meta_box" id="texto_meta_box" /&gt;
&lt;/p&gt;

&lt;?php
}

?&gt;

</pre>

<p>Agora vamos adicionar o DropDow em nosso Meta Box.</p>

<p>No drop-dow iremos usar uma das fun√ß√µes mais √∫teis no WordPress, o selected(). Ele compara o primeiro valor, os dados que salva, com o segundo atributo de valor, <option>. Se eles s√£o os mesmos a fun√ß√£o selected=&#8221;selected&#8221; que faz com o que o valor do drop down seja gravado. Mas voc√™ tamb√©m pode usar o selected com bot√µes de radio.</p>

<p>Ficando da seguinte forma:</p>

<pre class="lang-php">function vinil_meta_box_vinil()
{
$values = get_post_custom( $post-&gt;ID );
$text = isset( $values['texto_meta_box'] ) ? esc_attr( $values['texto_meta_box'][0] ) : '';
$selected = isset( $values['meta_box_select'] ) ? esc_attr( $values['meta_box_select'][0] ) : '';
$check = isset( $values['meta_box_check'] ) ? esc_attr( $values['meta_box_check'][0] ) : '';
wp_nonce_field( 'my_meta_box_nonce', 'meta_box_nonce' );
?&gt;
&lt;p&gt;
&lt;label for="texto_meta_box"&gt;Text Label&lt;/label&gt;
&lt;input type="text" name="texto_meta_box" id="texto_meta_box" /&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;label for="meta_box_select"&gt;Color&lt;/label&gt;
&lt;select name="meta_box_select" id="meta_box_select"&gt;
&lt;option value="red" &lt;?php selected( $selected, 'red' ); ?&gt;&gt;Vermelho&lt;/option&gt;
&lt;option value="blue" &lt;?php selected( $selected, 'blue' ); ?&gt;&gt;Azul&lt;/option&gt;
&lt;/select&gt;
&lt;/p&gt;
&lt;?php
}

?&gt;

</pre>

<h3 id="adicionando-o-check-box">Adicionando o Check box</h3>

<pre class="lang-php">function vinil_meta_box_vinil()
{
$values = get_post_custom( $post-&gt;ID );
$text = isset( $values['texto_meta_box'] ) ? esc_attr( $values['texto_meta_box'][0] ) : '';
$selected = isset( $values['meta_box_select'] ) ? esc_attr( $values['meta_box_select'][0] ) : '';
$check = isset( $values['meta_box_check'] ) ? esc_attr( $values['meta_box_check'][0] ) : '';
wp_nonce_field( 'my_meta_box_nonce', 'meta_box_nonce' );
?&gt;
&lt;p&gt;
&lt;label for="texto_meta_box"&gt;Text Label&lt;/label&gt;
&lt;input type="text" name="texto_meta_box" id="texto_meta_box" /&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;label for="meta_box_select"&gt;Color&lt;/label&gt;
&lt;select name="meta_box_select" id="meta_box_select"&gt;
&lt;option value="red" &lt;?php selected( $selected, 'red' ); ?&gt;&gt;Vermelho&lt;/option&gt;
&lt;option value="blue" &lt;?php selected( $selected, 'blue' ); ?&gt;&gt;Azul&lt;/option&gt;
&lt;/select&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;input type="checkbox" name="meta_box_check" id="meta_box_check" &lt;?php checked( $check, 'on' ); ?&gt; /&gt;
&lt;label for="meta_box_check"&gt;Don't Check This.&lt;/label&gt;
&lt;/p&gt;
&lt;?php
}

?&gt;

</pre>

<p>Novamente o WordPress fornece a fun√ß√£o checked(). Ela funciona exatamente como selected() comparando o primeiro valor com o segundo valor e repetindo para checked=&#8221;checked&#8221; se eles s√£o o mesmo.</p>

<h2 id="para-finalizar-vamos-salvar-nosso-meta-box">Para finalizar vamos salvar nosso Meta Box</h2>

<p>Para salvar nossos dados, vamos confiar em outro gancho: save_post. Isso funciona como o nosso gancho na a√ß√£o acima:</p>

<pre class="lang-php">&lt;?php add_action( 'save_post', 'vinil_meta_box_save' ); ?&gt;

</pre>

<p>A fun√ß√£o vinil_meta_box receber√° um argumento, a ID do Post, e vai cuidar da limpeza e salvar todos os nossos dados.</p>

<p>Antes de podermos fazer qualquer coisa, no entanto, que temos que fazer 3 coisas: verificar se o Post esta auto salvando, verificar o valor √∫nico que criamos anteriormente, e verificar se o usu√°rio atual pode realmente editar o post.</p>

<pre class="lang-php">add_action( 'save_post', 'vinil_meta_box_save' );
function vinil_meta_box_save( $post_id )
{
if( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) return;

if( !isset( $_POST['meta_box_nonce'] ) || !wp_verify_nonce( $_POST['meta_box_nonce'], 'my_meta_box_nonce' ) ) return;

if( !current_user_can( 'edit_post' ) ) return;

}

</pre>

<p>Agora as coisas divertidas: na verdade, salvar nossos dados. A regra n√∫mero um, ao colocar qualquer coisa em seu banco de dados ou em seu site √© n√£o confiar no usu√°rio. Mesmo se esse usu√°rio √© voc√™. Para o efeito, antes de salvar os dados, queremos ter certeza de que n√£o h√° nada malicioso l√°. Felizmente WordPress fornece um monte de fun√ß√µes para valida√ß√£o de dados. Para isso vamos utilizar o esc_attr(). E tamb√©m vamos usar a fun√ß√£o update_post_meta para salvar os nossos dados. Leva tr√™s argumentos: a ID post, a chave de meta, e o valor.</p>

<pre class="lang-php">add_action( 'save_post', 'vinil_meta_box_save' );
function vinil_meta_box_save( $post_id )
{
if( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) return;

if( !isset( $_POST['meta_box_nonce'] ) || !wp_verify_nonce( $_POST['meta_box_nonce'], 'my_meta_box_nonce' ) ) return;

if( !current_user_can( 'edit_post' ) ) return;

$allowed = array(
'a' =&gt; array(
'href' =&gt; array()
)
);

if( isset( $_POST['texto_meta_box'] ) )
update_post_meta( $post_id, 'texto_meta_box', wp_kses( $_POST['texto_meta_box'], $allowed ) );

if( isset( $_POST['meta_box_select'] ) )
update_post_meta( $post_id, 'meta_box_select', esc_attr( $_POST['meta_box_select'] ) );

$chk = ( isset( $_POST['meta_box_check'] ) && $_POST['meta_box_check'] ) ? 'on' : 'off';
update_post_meta( $post_id, 'meta_box_check', $chk );
}

?&gt;

</pre>

<p>√â isso, agora voc√™ deve ter um Meta Boxes funcionando em seu WordPress.</p>

<h2 id="nosso-arquivo-fica-assim">Nosso arquivo fica assim:</h2>

<pre class="lang-php">&lt;?php
/*
Plugin Name: Meta Box
Plugin URI: http://bygiovanni.com.br
Description:
Version: 1.0
Author: Giovanni - Tableless
Author URI: http://bygiovanni.com.br
*/

//ADICIONANDO O META BOX
add_action( 'add_meta_boxes', 'vinil_meta_box_add' );
function vinil_meta_box_add()
{
add_meta_box( 'my-meta-box-id', 'Meu primeiro Meta Box', 'vinil_meta_box_vinil', 'post', 'normal', 'high' );
}

//FORMULARIO PARA SALVAS OS DADOS
function vinil_meta_box_vinil()
{
$values = get_post_custom( $post-&gt;ID );
$text = isset( $values['texto_meta_box'] ) ? esc_attr( $values['texto_meta_box'][0] ) : '';
$selected = isset( $values['meta_box_select'] ) ? esc_attr( $values['meta_box_select'][0] ) : '';
$check = isset( $values['meta_box_check'] ) ? esc_attr( $values['meta_box_check'][0] ) : '';
wp_nonce_field( 'my_meta_box_nonce', 'meta_box_nonce' );
?&gt;
&lt;p&gt;
&lt;label for="texto_meta_box"&gt;Text Label&lt;/label&gt;
&lt;input type="text" name="texto_meta_box" id="texto_meta_box" /&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;label for="meta_box_select"&gt;Color&lt;/label&gt;
&lt;select name="meta_box_select" id="meta_box_select"&gt;
&lt;option value="red" &lt;?php selected( $selected, 'red' ); ?&gt;&gt;Vermelho&lt;/option&gt;
&lt;option value="blue" &lt;?php selected( $selected, 'blue' ); ?&gt;&gt;Azul&lt;/option&gt;
&lt;/select&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;input type="checkbox" name="meta_box_check" id="meta_box_check" &lt;?php checked( $check, 'on' ); ?&gt; /&gt;
&lt;label for="meta_box_check"&gt;Don't Check This.&lt;/label&gt;
&lt;/p&gt;
&lt;?php
}

add_action( 'save_post', 'vinil_meta_box_save' );
function vinil_meta_box_save( $post_id )
{
if( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) return;

if( !isset( $_POST['meta_box_nonce'] ) || !wp_verify_nonce( $_POST['meta_box_nonce'], 'my_meta_box_nonce' ) ) return;

if( !current_user_can( 'edit_post' ) ) return;

$allowed = array(
'a' =&gt; array(
'href' =&gt; array()
)
);

if( isset( $_POST['texto_meta_box'] ) )
update_post_meta( $post_id, 'texto_meta_box', wp_kses( $_POST['texto_meta_box'], $allowed ) );

if( isset( $_POST['meta_box_select'] ) )
update_post_meta( $post_id, 'meta_box_select', esc_attr( $_POST['meta_box_select'] ) );

$chk = ( isset( $_POST['meta_box_check'] ) && $_POST['meta_box_check'] ) ? 'on' : 'off';
update_post_meta( $post_id, 'meta_box_check', $chk );
}

?&gt;

</pre>

<p>Para saber mais sobre os Meta Box podem ver no Codex que tamb√©m √© uma √≥tima fonte de estudo para o WP. <a href="http://codex.wordpress.org/Function_Reference/add_meta_box" target="_blank"><a href="http://codex.wordpress.org/Function_Reference/add_meta_box">http://codex.wordpress.org/Function_Reference/add_meta_box</a></a></p>

    </article>

<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = '';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
  </section>


  <aside class="tb-aside">
    Banner
  </aside>

</section>


<footer id="tb-footer">
    <div class="tb-container">
    <ul class="tb-social-links">
        <li><a href="http://facebook.com/tablelessbr">Facebook</a></li>
        <li><a href="http://twitter.com/tableless">Twitter</a></li>
        <li><a href="http://tableless.com.br/feed">RSS</a></li>
        <li><a href="http://medium.com/tableless">Medium</a></li>
    </ul>
    <nav class="tb-footer-nav">
        <a href="">Contato</a>
        <a href="">Anuncie</a>
        <a href="">Seja um Autor</a>
        <a href="">Fazemos c√≥digo front-end</a>
    </nav>

    <p class="tb-for-community">
        Escrito pela e para a comunidade web brasileira. <a href="">Ajude</a>.
    </p>
    </div>
</footer>
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script>
$(document).ready(function() {
  $('pre').each(function(i, block) {
    hljs.highlightBlock(block);
  });
})</script>


</body>
</html>

